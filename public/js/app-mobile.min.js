// document.addEventListener('DOMContentLoaded', function() {

const authModalHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr auth__vr">
        <div class="vr__close"></div>
        <div class="vr__header">Авторизация</div>
        <div class="vr__contents">
          <div class="auth auth--screen-login">
            <div class="auth__screen auth__login" data-type="login">
              <label class="auth__label auth__label--login auth__label--focus">
                <div class="auth__placeholder auth__placeholder--login-phone">Телефон</div>
                <input class="auth__input auth__input--login" type="tel" value="+375">
              </label>
              <label class="auth__label auth__label--password">
                <div class="auth__placeholder auth__placeholder--password">Пароль</div>
                <input type="password" class="auth__input auth__input--password">
              </label>
              <button class="auth__submit btload btload--white" data-text="Войти">
                <i class="btload__ico"></i>
                <i class="btload__ico"></i>
                <i class="btload__ico"></i>
              </button>
              <label class="auth__policy">
                <div class="auth__box"></div>
                <div class="auth__boxLabel">Я принимаю условия <a class="auth__boxLink" href="/terms" target="_blank">соглашения</a> и правила обработки <a class="auth__boxLink" href="/policy" target="_blank">персональных данных</a>
                </div>
                <input class="auth__boxCheckbox" type="checkbox">
              </label>
              <div class="auth__button auth__button--recover" data-type="recover">Восстановить пароль</div>
              <div class="auth__or">или</div>
              <div class="auth__button auth__button--register" data-type="register">Зарегистрироваться</div>
            </div>
            <div class="auth__screen auth__register" data-type="register">
              <label class="auth__label auth__label--login">
                <div class="auth__placeholder auth__placeholder--login">Логин</div>
                <input type="text" class="auth__input auth__input--login">
              </label>
              <label class="auth__label auth__label--password">
                <div class="auth__placeholder auth__placeholder--password">Пароль</div>
                <input type="password" class="auth__input auth__input--password">
              </label>
              <label class="auth__label auth__label--phone">
                <div class="auth__placeholder auth__placeholder--phone">Телефон</div>
                <input type="tel" class="auth__input auth__input--phone">
                <div class="auth__hint">Мы вышлем СМС с кодом подтверждения</div>
              </label>
              <div class="auth__captcha">
                <label class="auth__label auth__label--captcha">
                  <div class="auth__placeholder auth__placeholder--captcha">Captcha</div>
                  <input maxlength="4" name="captcha" type="tel" class="auth__input auth__input--captcha">
                </label>
                <img src="" class="auth__captchaImg">
              </div>
              <label class="auth__label auth__label--sms-code">
                <input type="text" class="auth__input auth__input--code" maxlength="5" placeholder="Код из СМС">
              </label>
              <div class="auth__hint auth__hint--sms" data-timer="30 секунд">Вы получите СМС через </div>
              <div class="auth__hint auth__hint--repeat-sms" data-repeat="Выслать повторно">Не получили CMC?</div>
              <label class="auth__policy">
                <div class="auth__box"></div>
                <div class="auth__boxLabel">Я принимаю условия <a class="auth__boxLink" href="/terms" target="_blank">соглашения</a> и правила обработки <a class="auth__boxLink" href="/policy" target="_blank">персональных данных</a>
                </div>
                <input class="auth__boxCheckbox" type="checkbox">
              </label>
              <button class="auth__submit btload btload--white" data-register="Зарегистрироваться" data-confirm="Подтвердить телефон"><i class="btload__ico"></i><i class="btload__ico"></i><i class="btload__ico"></i></button>
            </div>
            <div class="auth__screen auth__recover" data-type="recover">
              <label class="auth__label auth__label--phone  auth__label--focus">
                <div class="auth__placeholder auth__placeholder--phone">Телефон</div>
                <input type="tel" class="auth__input auth__input--phone" value="+375">
                <div class="auth__hint">Мы вышлем СМС с кодом подтверждения</div>
              </label>
              <label class="auth__label auth__label--password ">
                <div class="auth__placeholder auth__placeholder--new-password">Новый пароль</div>
                <input type="password" class="auth__input auth__input--password">
              </label>
              <div class="auth__captcha">
                <label class="auth__label auth__label--captcha">
                  <div class="auth__placeholder auth__placeholder--captcha">Captcha</div>
                  <input maxlength="4" name="captcha" type="tel" class="auth__input auth__input--captcha">
                </label>
                <img src="" class="auth__captchaImg">
              </div>
              <label class="auth__label auth__label--sms-code">
                <input type="text" class="auth__input auth__input--code" maxlength="5" placeholder="Код из СМС">
              </label>
              <div class="auth__hint auth__hint--sms" data-timer="30 секунд">Вы получите СМС через </div>
              <div class="auth__hint auth__hint--repeat-sms" data-repeat="Выслать повторно">Не получили CMC? </div>
              <button class="auth__submit btload btload--white" data-recover="Восстановить пароль" data-confirm="Подтвердить телефон"><i class="btload__ico"></i><i class="btload__ico"></i><i class="btload__ico"></i></button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const phoneModalHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr vr-mp">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="mp mp-active-phones">
            <div class="mp-header">
              <div class="mp-title">cafe180.by</div>
              <div class="mp-address">Служба бронирования и доставки</div>
              <div class="mp-tabs">
                <div class="mp-tab active" data-type="phones">Телефоны</div>
                <div class="mp-tab" data-type="worktime">Время работы</div>
              </div>
            </div>
            <div class="mp-tab-contents mp-tab-phones">
              <div class="mp-recall">
                <div class="mp-recall-title">Хотите, перезвоним Вам за 2 минуты?</div>
                <div class="mp-recall-wrap">
                  <input class="_vr-input mp-recall-phone" type="tel" value="+375">
                  <button class="_vr-button mp-recall-submit ease-background" data-city="73" data-company="xlab">Жду звонка</button>
                </div>
              </div>
              <a class="mp-phone no-decoration" href="tel:+375293798989">+375 (29) 379-89-89</a>
              <a class="mp-phone no-decoration" href="tel:+375333798979">+375 (33) 379-89-79</a>
            </div>
            <div class="mp-tab-contents mp-tab-worktime">
              <div class="mp-time " data-week="Пн">08:55 − 23:59</div>
              <div class="mp-time " data-week="Вт">08:55 − 23:59</div>
              <div class="mp-time " data-week="Ср">08:55 − 23:59</div>
              <div class="mp-time active" data-week="Чт">08:55 − 23:59</div>
              <div class="mp-time " data-week="Пт">08:55 − 01:00</div>
              <div class="mp-time " data-week="Сб">08:55 − 01:00</div>
              <div class="mp-time " data-week="Вс">08:55 − 23:59</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const filterModalHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="exf">
            <div class="exf__groups">
              <div class="exfgroup">
                <div class="exfgroup__title">Способы оплаты</div>
                <div class="exfgroup__items">
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="cash">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Наличными</div>
                  </label>
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="online">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Картой онлайн</div>
                  </label>
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="card">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Картой курьеру</div>
                  </label>
                </div>
              </div>
              <div class="exfgroup">
                <div class="exfgroup__title">Опции</div>
                <div class="exfgroup__items">
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="open">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Открытые</div>
                  </label>
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="promo">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Акция</div>
                  </label>
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="preorder">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Предзаказ</div>
                  </label>
                  <label class="exfitem exfitem--checkbox">
                    <input type="checkbox" class="exfitem__checkbox" value="pickup">
                    <div class="exfitem__ico-checkbox"></div>
                    <div class="exfitem__text">Навынос</div>
                  </label>
                </div>
              </div>
              <div class="exfgroup">
                <div class="exfgroup__title">В меню</div>
                <div class="exfgroup__items">
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="all" checked>
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Все</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="pizza">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Пицца</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="shaurma">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Шаурма</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="sushi">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Суши</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="burger">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Бургеры</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="soup">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Супы</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="hot">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Горячие блюда</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="grill">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Гриль</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="shashlik">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Шашлык</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="pasta">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Паста</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="wok">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">WOK</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="breakfast">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Завтраки</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="dessert">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Десерты</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="salad">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Салаты</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="dinner">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Обеды</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="pastry">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Выпечка</div>
                  </label>
                  <label class="exfitem exfitem--radio">
                    <input type="radio" name="inMenu" class="exfitem__radio" value="flowers">
                    <div class="exfitem__ico-radio"></div>
                    <div class="exfitem__text">Цветы</div>
                  </label>
                </div>
              </div>
            </div>
            <div class="exf__submit-wrap">
              <button class="exf__submit">Применить</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const cityDropdownHTML = `
  <div data-tippy-root="" id="tippy-56" style="z-index: 9999; visibility: visible; margin: 0px; position: absolute; inset: 0px auto auto 0px; transform: translate3d(-20px, 35px, 0px);">
    <div class="tippy-box" data-state="visible" tabindex="-1" data-theme="dropdown city" data-animation="shift-toward-subtle" role="tooltip" data-placement="bottom-start" style="max-width: none; transition-duration: 300ms;">
      <div class="tippy-content" data-state="visible" style="transition-duration: 300ms;">
        <div class="tdrop ">
          <div class="tdrop__option" data-item="1">Новополоцк</div>
          <div class="tdrop__option" data-item="2">Полоцк</div>
        </div>
      </div>
      <div class="tippy-arrow" style="position: absolute; top: 0px; left: 0px; transform: translate3d(70.5px, 0px, 0px);"></div>
    </div>
  </div>`;

const foodSelHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr tp__form">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="tp">
            <div class="tp__imageWrapper">
              <div class="tp__image-wrap lazyload__wrap lazyloaded" data-expand="-1">
                <img alt="" class="tp__image ls-is-cached lazyloaded" src="https://cdn.clever.by/assets/2025/07/28/4400a6a6a2c93332aeafd6e8b9a817---png_1100_1e6e0_convert.webp">
              </div>
            </div>
            <div class="tp__content shadow">
              <div class="tsizes">
                <div class="tsizes__info">
                  <div class="tsizes__info-name">Шаурма «Классическая»</div>
                  <div class="tsizes__info-price">11&nbsp;руб.<span class="tsizes__info-size">430 г</span></div>
                </div>
                <div class="ingr__wrap tsizes__ingr">
                  <div class="ingr">Лаваш, куриное филе, капуста, томат, соленый огурец, соус&nbsp;«Фирменный»</div>
                </div>
                <div class="tsizes__description">Настоящая уличная легенда! Сочное мясо, хрустящие овощи, ароматные 
                  специи и нежный соус, завёрнутые в мягкую лавашную лепёшку. Идеальный баланс вкусов для тех, кто 
                  любит аутентичную шаурму как из лучших уличных кафе.
                </div>
              </div>
              <div class="tmod">
                <div class="tmod__title">Начинки для блинов</div>
                <div class="tmod__options">
                  <div class="topt"><img alt="" src="https://cdn.clever.by/assets/2025/04/14/350dc4bc041bf670683247bc106fc5---png_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Моцарелла, 10&nbsp;г</span> <span class="topt__price">+0,70&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/fce07c97ffd86d5f0ac575d191f0a2---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Сыр творожный, 10&nbsp;г</span> <span class="topt__price">+0,70&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/c8a0acd97db934c7d28b74cef6c26a---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Охотничьи колбаски, 10&nbsp;г</span> <span class="topt__price">+0,70&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/15f0c426496be7d3c433091e9946e3---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Ветчина, 10&nbsp;г</span> <span class="topt__price">+0,70&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/e36556b05338bd99a8de9a6849623c---png_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Пеперони, 10&nbsp;г</span> <span class="topt__price">+0,70&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/96f37619c04fcf566c0ca73e240fa7---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Огурчики маринованные, 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/3ec54301b6c0d99945c989a4624596---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Горчичный», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/6092b2cd858512c0912bd1c1d86157---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Сырный», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/9ca58e73b435afd870cad870dc8b06---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Тартар», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/f6019cebda432579616c514bd7506f---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «1000 островов», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/2df49890e51b1ba5f725a596093962---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Сладкий Чили», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt"><img alt="" src="https://cdn.clever.by/assets/2025/04/16/42bd4640beac3ed9474946290e7add---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Барбекю», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/3b26c8ea968c907464304d340d6a3d---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Соус «Кетчуп», 5&nbsp;г</span> <span class="topt__price">+0,30&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/07fc538593b0ea620bfc57c4a1df18---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Зелень, 5&nbsp;г</span> <span class="topt__price">+0,60&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                  <div class="topt">
                    <img alt="" src="https://cdn.clever.by/assets/2025/04/16/553bc597b242baa6525be627e0b0ca---jpg_160x160_b3903_convert.webp" class="topt__photo">
                    <div class="topt__name">
                      <span class="topt__name-wrap">Перец Халапеньо, 5&nbsp;г</span> <span class="topt__price">+0,60&nbsp;руб.</span>
                    </div>
                    <div class="topt__checkbox"></div>
                  </div>
                </div>
              </div>
              <div class="tp__indicator"></div>
            </div>
            <div class="tsubmit">
              <div class="tsubmit__buttons">
                <div class="tsubmit__counter">
                  <div class="tsubmit__minus tsubmit__minus--inactive"></div>
                  <div class="tsubmit__count">1</div>
                  <div class="tsubmit__plus"></div>
                </div>
                <div class="tsubmit__button">Добавить к заказу</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const reportHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr ch__viewer">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="ch" data-screen="main">
            <div class="ch__screen ch__screen--main">
              <div class="ch__header">
                <div class="ch__title">Хьюстон,<br>у нас проблемы!</div>
                <div class="ch__subtitle">Пожалуйста, сообщите<br> нам о проблеме, с которой<br> вы столкнулись, используя<br> сервис Clever.by.</div>
              </div>
              <a href="tel:375295550505" class="ch__phone-wrapper">
                <div class="ch__phone">
                  <div class="ch__phone-number" data-before="Тел. моб.:" data-after="A1, MTC">555-05-05</div>
                  <div class="ch__phone-descr">Позвоните, и мы постараемся помочь<br> в реальном времени — прямо сейчас.</div>
                </div>
              </a>
              <div class="ch__form">
                <div class="ch__caption">Оставьте отзыв<br> или сообщение</div>
                <div class="ch__field">
                  <div class="ch__input-caption" data-text="Ваше имя"></div>
                  <input class="ch__input ch__input--name">
                </div>
                <div class="ch__field">
                  <div class="ch__input-caption" data-text="Ваш номер телефона"></div>
                  <input type="text" class="ch__input ch__input--phone">
                </div>
                <div class="ch__field ch__field--textarea">
                  <div class="ch__input-caption" data-text="Ваше сообщение"></div>
                  <textarea class="ch__input ch__input--textarea ch__input--txt"></textarea>
                </div>
                <div class="ch__field ch__field--description">
                  <div class="ch__form-descr">Пожалуйста, опишите проблему<br> подробнее. Чем больше деталей,<br> тем быстрее мы найдём решение.</div>
                </div>
                <label class="сh__policyWrap">
                  <div class="ch__box"></div>
                  <div class="ch__boxLabel">Я принимаю условия <a class="ch__boxLink" href="/terms" target="_blank">соглашения</a> 
                    и правила обработки <a class="ch__boxLink" href="/policy" target="_blank">персональных данных</a>
                  </div>
                  <input class="ch__boxCheckbox" type="checkbox">
                </label>
                <div class="ch__field">
                  <button class="ch__submit btload btload--white" data-text="Отправить">
                    <i class="btload__ico"></i>
                    <i class="btload__ico"></i>
                    <i class="btload__ico"></i>
                  </button>
                </div>
              </div>
            </div>
            <div class="ch__screen ch__screen--success ch__success">
              <div class="ch__success-title">Сообщение отправлено!</div>
              <svg class="ch__checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="ch__checkmark-circle" cx="26" cy="26" r="25" fill="none"></circle><path class="ch__checkmark-check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"></path></svg>
              <div class="ch__success-message">Служба поддержки клиентов<br> Clever.by работает с 08:55 до 01:00.<br> Мы получили сообщение о проблеме<br> и свяжемся с вами как можно раньше.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const writeTestimonialHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr rwadd__vr">
        <div class="vr__close"></div>
        <div class="vr__header">Написать отзыв</div>
        <div class="vr__contents">
          <div class="rwadd">
            <div class="xform__field xform__field--images">
              <div class="xform__image xform__image--empty xform__image--start" data-type="start" data-uid="e0.13360255976108948" style="z-index: 1;"></div>
              <div class="xform__image xform__image--empty xform__image--receipt" data-type="receipt" data-uid="e0.057490763540544165" style="z-index: 1;"></div>
              <div class="xform__image xform__image--empty xform__image--selfie" data-type="selfie" data-uid="e0.3200884765961466" style="z-index: 1;"></div>
              <div id="html5_1j4aqdcpr16it16d51bu719qr1krl5_container" class="moxie-shim moxie-shim-html5" style="position: absolute; top: 0px; left: 46px; width: 85px; height: 70px; overflow: hidden; z-index: 0;">
                <input id="html5_1j4aqdcpr16it16d51bu719qr1krl5" type="file" style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" multiple="" accept=".jpg,.jpeg,.png" tabindex="-1">
              </div>
              <div id="html5_1j4aqdcps1rb81gmt1a2f1k7ng3e9_container" class="moxie-shim moxie-shim-html5" style="position: absolute; top: 0px; left: 147px; width: 85px; height: 70px; overflow: hidden; z-index: 0;">
                <input id="html5_1j4aqdcps1rb81gmt1a2f1k7ng3e9" type="file" style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" accept=".jpg,.jpeg,.png" tabindex="-1">
              </div>
              <div id="html5_1j4aqdcptna71dl0rvo1ulciu3d_container" class="moxie-shim moxie-shim-html5" style="position: absolute; top: 0px; left: 248px; width: 85px; height: 70px; overflow: hidden; z-index: 0;">
                <input id="html5_1j4aqdcptna71dl0rvo1ulciu3d" type="file" style="font-size: 999px; opacity: 0; position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" accept=".jpg,.jpeg,.png" tabindex="-1">
              </div>
            </div>
            <div class="xform__field xform__field--info">
              Вы не авторизованы, поэтому не сможете<br> заработать баллы. Пожалуйста, <a href="#" class="rwadd__auth">авторизуйтесь</a>!
            </div>
            <div class="xform__field xform__field--required rwadd__field--city">
              <input class="xform__input rwadd__city" placeholder="Город" value="Новополоцк"><div class="xsuggest  hidden"></div>
            </div>
            <div class="xform__field xform__field--required rwadd__field--company">
              <input class="xform__input rwadd__company" placeholder="Заведение" value="180 градусов" data-id="4319"><div class="xsuggest  hidden"></div>
            </div>
            <div class="xform__marks">
              <div class="xform__field xform__field--mark ">
                <div class="xform__mark-title xform__mark-title--required">Скорость доставки</div>
                <div class="xform__mark xform__mark--glue" data-mark="default" data-type="speed">
                  <div class="xform__mark-slider">
                    <div data-default="потяните" data-mark1="1" data-mark2="2" data-mark3="3" data-mark4="4" data-mark5="5" class="xform__mark-slider-text"></div>
                  </div>
                </div>
              </div>
              <div class="xform__field xform__field--mark">
                <div class="xform__mark-title xform__mark-title--required">Кухня</div>
                <div class="xform__mark" data-mark="default" data-type="cuisine">
                  <div class="xform__mark-slider"><div data-default="потяните" data-mark1="1" data-mark2="2" data-mark3="3" data-mark4="4" data-mark5="5" class="xform__mark-slider-text"></div></div>
                </div>
              </div>
              <div class="xform__field xform__field--mark ">
                <div class="xform__mark-title xform__mark-title--required">Сервис (общение, курьер, оплата)</div>
                <div class="xform__mark" data-mark="default" data-type="service">
                  <div class="xform__mark-slider"><div data-default="потяните" data-mark1="1" data-mark2="2" data-mark3="3" data-mark4="4" data-mark5="5" class="xform__mark-slider-text"></div></div>
                </div>
              </div>
            </div>
            <div class="xform__field xform__field--required">
              <textarea class="xform__input rwadd__txt" placeholder="Текст отзыва" style="height: 90px;"></textarea>
            </div>
            <div class="rwadd__footer">
              <div class="rwadd__phone">
                <input type="tel" class="rwadd__number rwadd__input" value="+375" placeholder="+375">
                <input class="rwadd__sms-code rwadd__input" placeholder="код из sms" maxlength="5">
                <button class="rwadd__sms-send">Получить SMS</button>
                <div class="rwadd__sms-hint">Номер телефона с подтверждением через смс</div>
              </div>
              <button class="xform__save rwadd__save" data-secret-book="" data-secret="" data-company="4319" data-menu-type="3">Отправить</button>
            </div>
          </div>
          <div class="xform__mark-dummy"></div>
        </div>
      </div>
    </div>
  </div>`;

const openAboutMapHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="about">
            <div class="map">
              <div class="map__title">Зона доставки</div>
              <div class="map__container">
                <div class="map__area leaflet-container leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag" tabindex="0">
                  <div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);">
                    <div class="leaflet-pane leaflet-tile-pane">
                      <div class="leaflet-layer " style="z-index: 1; opacity: 1;">
                        <div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 14; transform: translate3d(150px, 113px, 0px) scale(0.0625);"></div>
                        <div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(0px, 0px, 0px) scale(1);">
                          <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=643&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-86px, -192px, 0px); opacity: 1;">
                          <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=643&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(170px, -192px, 0px); opacity: 1;">
                          <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=644&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-86px, 64px, 0px); opacity: 1;">
                          <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=644&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(170px, 64px, 0px); opacity: 1;">
                        </div>
                      </div>
                    </div>
                    <div class="leaflet-pane leaflet-shadow-pane"></div>
                    <div class="leaflet-pane leaflet-overlay-pane">
                      <svg pointer-events="none" class="leaflet-zoom-animated" width="348" height="360" viewBox="-29 -30 348 360" style="transform: translate3d(-29px, -30px, 0px);">
                        <g><path class="leaflet-interactive" stroke="#3FA7D6" stroke-opacity="1" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill="#3FA7D6" fill-opacity="0.2" fill-rule="evenodd" d="M210 189L201 180L196 183L181 178L182 170L191 167L187 161L182 166L179 162L182 158L179 153L172 159L167 156L165 160L161 159L167 152L164 149L168 148L169 143L166 142L163 146L136 131L132 138L69 185L74 182L79 190L74 193L113 244L91 256L76 249L44 203L41 192L44 190L48 192L56 187L47 174L48 165L11 131L11 122L34 96L55 68L52 58L59 50L72 47L80 47L87 51L95 45L114 61L126 75L129 75L143 85L155 96L164 101L178 98L187 94L189 97L191 93L203 104L209 105L215 102L224 111L239 116L255 118L260 112L272 119L280 127L274 143L255 155L240 168L248 180L255 195L260 213L267 230L244 236L232 212L217 197z"></path></g>
                      </svg>
                    </div>
                    <div class="leaflet-pane leaflet-marker-pane">
                      <div class="leaflet-marker-icon marker leaflet-zoom-animated leaflet-interactive" tabindex="0" style="margin-left: -7px; margin-top: -23px; width: 14px; height: 23px; transform: translate3d(171px, 130px, 0px); z-index: 130;">
                        <svg width="14" height="23" viewBox="0 0 14 23" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <g clip-path="url(#clip0_706_2)">
                            <path d="M13.5091 15.8103C13.7455 15.5739 13.7455 15.1907 13.5091 14.9543C13.2728 14.7179 12.8895 14.7179 12.6532 14.9543L5.87528 21.7322C5.63891 21.9685 5.63891 22.3518 5.87528 22.5881C6.11165 22.8245 6.49488 22.8245 6.73125 22.5881L13.5091 15.8103Z" fill="url(#paint0_linear_706_2)"></path>
                            <path d="M6.05263 12.1053C9.39541 12.1053 12.1053 9.39541 12.1053 6.05263C12.1053 2.70986 9.39541 0 6.05263 0C2.70986 0 0 2.70986 0 6.05263C0 9.39541 2.70986 12.1053 6.05263 12.1053Z" fill="black"></path>
                            <path d="M6.05265 10.8948C8.72687 10.8948 10.8948 8.72687 10.8948 6.05265C10.8948 3.37843 8.72687 1.21054 6.05265 1.21054C3.37843 1.21054 1.21054 3.37843 1.21054 6.05265C1.21054 8.72687 3.37843 10.8948 6.05265 10.8948Z" fill="white"></path>
                            <path d="M6.65788 12.1053C6.65788 11.771 6.3869 11.5 6.05262 11.5C5.71834 11.5 5.44736 11.771 5.44736 12.1053V22.3947C5.44736 22.729 5.71834 23 6.05262 23C6.3869 23 6.65788 22.729 6.65788 22.3947V12.1053Z" fill="black"></path>
                          </g>
                          <defs>
                            <linearGradient id="paint0_linear_706_2" x1="6.05268" y1="22.982" x2="12.4079" y2="16.9294" gradientUnits="userSpaceOnUse">
                              <stop stop-opacity="0.4"></stop>
                              <stop offset="1" stop-opacity="0"></stop>
                            </linearGradient>
                            <clipPath id="clip0_706_2">
                              <rect width="13.9211" height="23" fill="white"></rect>
                            </clipPath>
                          </defs>
                        </svg>
                      </div>
                    </div>
                    <div class="leaflet-pane leaflet-tooltip-pane"></div>
                    <div class="leaflet-pane leaflet-popup-pane"></div>
                    <div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(303847px, 164950px, 0px) scale(1024);"></div>
                  </div>
                  <div class="leaflet-control-container">
                    <div class="leaflet-top leaflet-left">
                      <div class="leaflet-control-zoom leaflet-bar leaflet-control map__control">
                        <a class="leaflet-control-zoom-in" href="#" title="Zoom in" role="button" aria-label="Zoom in">+</a>
                        <a class="leaflet-control-zoom-out" href="#" title="Zoom out" role="button" aria-label="Zoom out">−</a>
                      </div>
                    </div>
                    <div class="leaflet-top leaflet-right"></div>
                    <div class="leaflet-bottom leaflet-left"></div>
                    <div class="leaflet-bottom leaflet-right"></div>
                  </div>
                </div>
                <div class="msearch">
                  <div class="msearch__spoiler msearch__spoiler--close">
                    <div class="msearch__button"></div>
                    <div class="">
                      <input type="text" placeholder="Поиск по адресу" class="msearch__input">
                      <i class="msearch__clear">
                        <svg width="9" height="9" viewBox="0 0 9 9" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M7.22042 0.773994L8.15691 1.71049L5.09254 4.7737L8.15691 7.8375L7.22042 8.77399L4.15662 5.70962L1.09341 8.77399L0.156914 7.8375L3.22071 4.7737L0.156914 1.71049L1.09341 0.773994L4.15662 3.83779L7.22042 0.773994Z" fill="black"></path>
                        </svg>
                      </i>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <div class="map__restaurants">
                  <div class="rest">
                    <div class="rest__address">г. Новополоцк, ул. Молодёжная, 92а</div>
                  </div>
                </div>
              </div>
            </div>
            <div class="wt">
              <div class="wt__title">Время работы</div>
              <div data-day="Пн" class="wt__item">12:00 − 20:00</div>
              <div data-day="Вт" class="wt__item">12:00 − 20:00</div>
              <div data-day="Ср" class="wt__item">12:00 − 20:00</div>
              <div data-day="Чт" class="wt__item">12:00 − 20:00</div>
              <div data-day="Пт" class="wt__item wt__item--active">12:00 − 20:00</div>
              <div data-day="Сб" class="wt__item">12:00 − 20:00</div>
              <div data-day="Вс" class="wt__item">12:00 − 20:00</div>
            </div>
            <div class="pay">
              <div class="pay__title">Форма оплаты</div>
              <div class="pay__item pay__item--online">Картой<br>онлайн</div>
            </div>
            <div class="legal">
              <div class="legal__title">Юр. информация</div>
              <div class="legal__text">ОДО Компания Викинг Туристик<br>УНП 391297816<br>Витебская обл. Ушачский р-н, д.Рубаники д. 2, ком. 3</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const openAddressMapHTML = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr addrvr">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div>
            <div class="amain">
              <div class="amain__map">
                <div class="amap">
                  <div class="abar">
                    <div class="abar__box abar__box--zoom">
                      <div class="abar__button abar__zoom abar__zoom--plus"></div>
                      <div class="abar__button abar__zoom abar__zoom--minus"></div>
                    </div>
                    <div class="abar__box abar__box--location">
                      <div class="abar__button abar__location">
                        <svg viewBox="0 0 22 22" width="22" height="22" xmlns="http://www.w3.org/2000/svg" class="abar__location-svg">
                          <g stroke="none" stroke-width="1" fill-rule="evenodd">
                            <g transform="translate(-273 -465)">
                              <g transform="translate(261 451)">
                                <path transform="rotate(45 26 22)" d="M26 11l8 22-8-4.369L18 33z"></path>
                              </g>
                            </g>
                          </g>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div class="amap__leaflet leaflet-container leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag" tabindex="0" style="position: relative;">
                    <div class="leaflet-pane leaflet-map-pane" style="transform: translate3d(0px, 0px, 0px);">
                      <div class="leaflet-pane leaflet-tile-pane">
                        <div class="leaflet-layer " style="z-index: 1; opacity: 1;">
                          <div class="leaflet-tile-container leaflet-zoom-animated" style="z-index: 18; transform: translate3d(0px, 0px, 0px) scale(1);">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=644&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(13px, 370px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=643&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(13px, 114px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1185&amp;y=644&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-243px, 370px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=644&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(269px, 370px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=645&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(13px, 626px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1185&amp;y=643&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-243px, 114px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=643&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(269px, 114px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1185&amp;y=645&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-243px, 626px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=645&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(269px, 626px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=642&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(13px, -142px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1186&amp;y=646&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(13px, 882px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1185&amp;y=642&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-243px, -142px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=642&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(269px, -142px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1185&amp;y=646&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(-243px, 882px, 0px); opacity: 1;">
                            <img alt="" role="presentation" src="https://core-renderer-tiles.maps.yandex.net/tiles?l=map&amp;x=1187&amp;y=646&amp;z=11&amp;scale=2&amp;lang=ru_RU" class="leaflet-tile leaflet-tile-loaded" style="width: 256px; height: 256px; transform: translate3d(269px, 882px, 0px); opacity: 1;">
                          </div>
                        </div>
                      </div>
                      <div class="leaflet-pane leaflet-shadow-pane"></div>
                      <div class="leaflet-pane leaflet-overlay-pane"></div>
                      <div class="leaflet-pane leaflet-marker-pane"></div>
                      <div class="leaflet-pane leaflet-tooltip-pane"></div>
                      <div class="leaflet-pane leaflet-popup-pane"></div>
                      <div class="leaflet-proxy leaflet-zoom-animated" style="transform: translate3d(303848px, 164951px, 0px) scale(1024);"></div>
                      <div class="leaflet-pane leaflet-delivery-pane">
                        <div class="leaflet-marker-icon amap__marker leaflet-zoom-animated leaflet-interactive" tabindex="0" style="margin-left: -15px; margin-top: -47px; width: 30px; height: 47px; transform: translate3d(245px, 457px, 0px); z-index: 10457;">
                          <svg class="amap__marker-svg" width="30" height="47" viewBox="0 0 30 47" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="15" cy="15" r="15"></circle>
                            <rect x="14" y="22" width="2" height="25" rx="1"></rect>
                          </svg>
                        </div>
                        <svg pointer-events="none" class="leaflet-zoom-animated" width="587" height="1096" viewBox="-49 -91 587 1096" style="transform: translate3d(-49px, -91px, 0px);">
                          <g><path class="leaflet-interactive" stroke="rgba(0, 163, 255, 0.9)" stroke-opacity="1" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill="rgba(0, 163, 255, 0.9)" fill-opacity="0.2" fill-rule="evenodd" d="M309 495L300 486L295 489L280 484L281 476L290 473L286 467L281 472L278 468L281 464L278 459L271 465L266 462L264 466L260 465L266 458L263 455L267 454L268 449L265 448L262 452L235 437L231 444L168 491L173 488L178 496L173 499L212 550L190 562L175 555L143 509L140 498L143 496L147 498L155 493L146 480L147 471L110 437L110 428L133 402L154 374L151 364L158 356L171 353L179 353L186 357L194 351L213 367L225 381L228 381L242 391L254 402L263 407L277 404L286 400L288 403L290 399L302 410L308 411L314 408L323 417L338 422L354 424L359 418L371 425L379 433L373 449L354 461L339 474L347 486L354 501L359 519L366 536L343 542L331 518L316 503z"></path></g>
                        </svg>
                      </div>
                      <div class="leaflet-pane leaflet-pickup-pane" style="display: none;"></div>
                    </div>
                    <div class="leaflet-control-container">
                      <div class="leaflet-top leaflet-left"></div>
                      <div class="leaflet-top leaflet-right"></div>
                      <div class="leaflet-bottom leaflet-left"></div>
                      <div class="leaflet-bottom leaflet-right"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="amain__content">
                <div class="amain__close">
                  <svg width="15" height="13" viewBox="0 0 15 13" class="amain__close-ico amain__close-ico--mobile">
                    <path d="M0.428535 5.48082L5.55553 0.420435C5.83641 0.151149 6.21637 1.85785e-07 6.61241 2.20408e-07C7.00846 2.55032e-07 7.38841 0.151149 7.66929 0.420435C7.8098 0.554844 7.92133 0.714755 7.99744 0.890942C8.07355 1.06713 8.11273 1.25611 8.11273 1.44697C8.11273 1.63784 8.07355 1.82682 7.99744 2.003C7.92133 2.17919 7.8098 2.3391 7.66929 2.47351L5.06082 5.04708L13.5009 5.04708C13.8985 5.04708 14.2798 5.19941 14.5609 5.47055C14.8421 5.74169 15 6.10945 15 6.4929C15 6.87636 14.8421 7.24411 14.5609 7.51525C14.2798 7.7864 13.8985 7.93873 13.5009 7.93873L5.06082 7.93873L7.69928 10.5412C7.97759 10.8154 8.13158 11.185 8.12736 11.5686C8.12314 11.9523 7.96107 12.3186 7.67679 12.5871C7.39251 12.8555 7.00932 13.004 6.6115 12.9999C6.21369 12.9959 5.83385 12.8395 5.55553 12.5654L0.428535 7.50498C0.153856 7.23471 -4.17891e-07 6.87135 -3.84806e-07 6.4929C-3.51721e-07 6.11445 0.153856 5.75109 0.428535 5.48082Z"></path>
                  </svg>
                  <div class="amain__close-ico amain__close-ico--desktop"></div>
                </div>
                <div class="adelivery">
                  <div class="adelivery__title">На какой адрес доставить?</div>
                  <div class="adelivery__field">
                    <div class="asearch">
                      <label class="ainput ainput--filled ainput--with-tick" autogrow="true">
                        <div class="ainput__caption">Адрес доставки</div>
                        <textarea class="ainput__text" style="height: 18px;"></textarea>
                        <div class="ainput__tick">Ваши<br> адреса</div>
                      </label>
                    </div>
                  </div>
                  <div class="adelivery__field adelivery__field--3">
                    <div class="adelivery__col">
                      <label class="ainput">
                        <div class="ainput__caption">Квартира</div>
                        <textarea class="ainput__text" style="height: 18px;"></textarea>
                      </label>
                    </div>
                    <div class="adelivery__col">
                      <label class="ainput">
                        <div class="ainput__caption">Подъезд</div>
                        <textarea class="ainput__text" style="height: 18px;"></textarea>
                      </label>
                    </div>
                    <div class="adelivery__col">
                      <label class="ainput">
                        <div class="ainput__caption">Этаж</div>
                        <textarea class="ainput__text" style="height: 18px;"></textarea>
                      </label>
                    </div>
                  </div>
                  <div class="adelivery__field adelivery__field--comment">
                    <label class="ainput" autogrow="true">
                      <div class="ainput__caption">Комментарий к адресу</div>
                      <textarea class="ainput__text" style="height: 18px;"></textarea>
                    </label>
                  </div>
                  <div class="adelivery__submit">
                    <div data-text="Готово" class="asubmit btload btload--white">
                      <i class="btload__ico"></i>
                      <i class="btload__ico"></i>
                      <i class="btload__ico"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const openCityList = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="cities">
            <div class="city__item">
              <div class="city__name" data-id="73" data-slug="novopolotsk">Новополоцк</div>
            </div>
            <div class="city__item">
              <div class="city__name" data-id="82" data-slug="polotsk">Полоцк</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>`;

const openSearch = `
  <div class="vr__layout">
    <div class="vr__wrap">
      <div class="vr">
        <div class="vr__close"></div>
        <div class="vr__contents">
          <div class="search">
            <input class="search__input" data-city="" data-company="" placeholder="Поиск блюд и ресторанов">
              <i class="search__cancel"></i>
            </input>
          </div>
          <div class="search__results">
          </div>
        </div>
      </div>
    </div>
  </div>`;


// const openCheckOutHTML = `
// <div class="vr__layout">
//   <div class="vr__wrap">
//     <div class="vr cart__viewer">
//       <div class="vr__close"></div>
//       <div class="vr__contents">
//         <div class="cart">
//           <div class="csdishes">
//             <div class="cheader">
//               <div class="cheader__title">180 градусов</div>
//               <div class="cheader__trash"></div>
//               <div class="cheader__close"></div>
//             </div>
//             <div class="csdishes__content">
//               <div class="cdv">
//                 <div class="cdv__item cdv__item--active" style="width: calc(50%);">
//                   <div class="cdv__name">Доставка</div>
//                   <div class="cdv__pointer" style="transform: translateX(0%);"></div>
//                 </div>
//                 <div class="cdv__item cdv__item--hoverable" style="width: calc(50%);">
//                   <div class="cdv__name">Навынос</div>
//                 </div>
//               </div>
//               <div class="cdishes">
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/07/28/43bfd8e9791791ac07792663a74a68---jpg_150x150:whitepadding7_4eac6_convert.jpg" class="cdish__photo">
//                   <div class="cdish__name">Шаурма «Сырная»
//                     <span class="cdish__size">460&nbsp;г</span>
//                   </div>
//                   <div class="cdish__ingredients">Лаваш, куриное филе, томат, капуста, соленый огурец, соус «Сырный»</div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">2</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">27&nbsp;руб.</div>
//                   </div>
//                 </div>
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/06/11/ba2d8d326effbc840f7a26d6ffc85d---png_150x150:whitepadding7_4eac6_convert.png" class="cdish__photo cdish__photo--border">
//                   <div class="cdish__name">Лимонад «Бамбл»
//                     <span class="cdish__sub"> Джусс Болл&nbsp;(3)</span>
//                     <span class="cdish__size">350&nbsp;г</span>
//                   </div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">4</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">42&nbsp;руб.</div>
//                   </div>
//                 </div>
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/04/07/cdc2784bdb86cb68998483cdb09562---jpg_150x150:whitepadding7_4eac6_convert.jpg" class="cdish__photo">
//                   <div class="cdish__name">Суп с курицей и лапшой
//                     <span class="cdish__size">350&nbsp;г</span>
//                   </div>
//                   <div class="cdish__ingredients">Филе по-азиатски, картофель фри, бульон, зелень, тесто,</div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">1</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">6,20&nbsp;руб.</div>
//                   </div>
//                 </div>
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/04/07/4e0d3936ad353eabdfd23155a9127c---jpg_150x150:whitepadding7_4eac6_convert.jpg" class="cdish__photo">
//                   <div class="cdish__name">Тако с курицей
//                     <span class="cdish__sub"> Моцарелла, Куриное филе&nbsp;(4), Сыр творожный</span>
//                     <span class="cdish__size">60&nbsp;г</span>
//                   </div>
//                   <div class="cdish__ingredients">Филе курицы, тортилья, овощи</div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">3</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">18,60&nbsp;руб.</div>
//                   </div>
//                 </div>
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/07/28/4400a6a6a2c93332aeafd6e8b9a817---png_150x150:whitepadding7_4eac6_convert.png" class="cdish__photo">
//                   <div class="cdish__name">Шаурма «Классическая»
//                     <span class="cdish__sub"> Охотничьи колбаски&nbsp;(2), Соус «Сырный»</span>
//                     <span class="cdish__size">430&nbsp;г</span>
//                   </div>
//                   <div class="cdish__ingredients">Лаваш, куриное филе, капуста, томат, соленый огурец, соус «Фирменный»</div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">1</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">12,70&nbsp;руб.</div>
//                   </div>
//                 </div>
//                 <div class="cdish cdish--with-photo">
//                   <img src="https://cdn.clever.by/assets/2025/07/28/4400a6a6a2c93332aeafd6e8b9a817---png_150x150:whitepadding7_4eac6_convert.png" class="cdish__photo">
//                   <div class="cdish__name">Шаурма «Классическая»
//                     <span class="cdish__sub"> Моцарелла</span>
//                     <span class="cdish__size">430&nbsp;г</span>
//                   </div>
//                   <div class="cdish__ingredients">Лаваш, куриное филе, капуста, томат, соленый огурец, соус «Фирменный»</div>
//                   <div class="cdish__meta">
//                     <div class="cdish__controls">
//                       <div class="cdish__control cdish__control--minus"></div>
//                       <div class="cdish__num">2</div>
//                       <div class="cdish__control cdish__control--plus"></div>
//                     </div>
//                     <div class="cdish__price">23,40&nbsp;руб.</div>
//                   </div>
//                 </div>
//               </div>
//               <div class="cextra">
//                 <div class="cextra__header">Добавить к заказу?</div>
//                 <div class="cextra__scrollable">
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/14/350dc4bc041bf670683247bc106fc5---png_240x200_0e9ef_convert.png" class="cextra__photo">
//                     <div class="cextra__name">Моцарелла</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/c02557a3b42db9f5f45a395e1ae86c---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Куриное филе</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/fce07c97ffd86d5f0ac575d191f0a2---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Сыр творожный</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/c8a0acd97db934c7d28b74cef6c26a---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Охотничьи колбаски</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/15f0c426496be7d3c433091e9946e3---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Ветчина</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/bdad7ac346f6e9f690fe3ca6e4e0e8---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Филе красной рыбы</div>
//                     <div class="cextra__price">1,20&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/e36556b05338bd99a8de9a6849623c---png_240x200_0e9ef_convert.png" class="cextra__photo">
//                     <div class="cextra__name">Пеперони</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/2335ed67fa5343af928826cde9d061---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Шоколад</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/2ad9e1563d2ac29d3de836b99b45af---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Вишнёвый джем</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/ed9663a515b8e75d167333ccfcf33a---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Клубничный джем</div>
//                     <div class="cextra__price">0,70&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/3ec54301b6c0d99945c989a4624596---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Горчичный»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/6092b2cd858512c0912bd1c1d86157---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Сырный»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/9ca58e73b435afd870cad870dc8b06---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Тартар»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/f6019cebda432579616c514bd7506f---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «1000 островов»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/2df49890e51b1ba5f725a596093962---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Сладкий Чили»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/42bd4640beac3ed9474946290e7add---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Барбекю»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/3b26c8ea968c907464304d340d6a3d---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Кетчуп»</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/96f37619c04fcf566c0ca73e240fa7---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Огурчики маринованные</div>
//                     <div class="cextra__price">0,30&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/07fc538593b0ea620bfc57c4a1df18---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Зелень</div>
//                     <div class="cextra__price">0,60&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/04/16/553bc597b242baa6525be627e0b0ca---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Перец Халапеньо</div>
//                     <div class="cextra__price">1&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/09/26/ee162a5cbd9a090035b864f0341983---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Шаурма»</div>
//                     <div class="cextra__price">0,20&nbsp;руб.</div>
//                   </div>
//                   <div class="cextra__item">
//                     <img src="https://cdn.clever.by/assets/2025/09/26/02399f1a548e824cd663588e7195d8---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
//                     <div class="cextra__name">Соус «Бургер»</div>
//                     <div class="cextra__price">0,40&nbsp;руб.</div>
//                   </div>
//                 </div>
//               </div>
//               <div class="cfee">
//                 <div class="cfee__right">
//                   <div class="ctaction cfee__action">Указать адрес</div>
//                 </div>
//                 <div class="cfee__left">
//                   <div class="cfee__title">Доставка</div>
//                   <div class="cfee__text">Укажите свой адрес,<br>чтобы рассчитать доставку</div>
//                 </div>
//               </div>
//               <div class="cpromo">
//                 <div class="cpromo__wrap">
//                   <div class="cpromo__title">Промокод</div>
//                   <div class="cpromo__right">
//                     <div class="ctaction cpromo__show">Ввести промокод</div>
//                   </div>
//                 </div>
//               </div>
//             </div>
//             <div class="cfooter cfooter--overlap">
//               <div class="cfooter__total">
//                 <div class="cfooter__left">Итого</div>
//                 <div class="cfooter__right">129,90&nbsp;руб.</div>
//               </div>
//               <button data-text="Далее" class="cfooter__submit btload btload--white">
//                 <i class="btload__ico"></i>
//                 <i class="btload__ico"></i>
//                 <i class="btload__ico"></i>
//               </button>
//             </div>
//           </div>
//         </div>
//       </div>
//     </div>
//   </div>
// </div>`;

const cpre = `  
    <div class="cpre__preorder">
      <div class="ctinput__wrap cpre__day">
        <div class="ctinput__caption">Предзаказ на</div>
        <div class="ctinput ctinput--tick cpre__day-input">Сегодня</div>
      </div>
      <div class="ctinput__wrap cpre__time">
        <div class="ctinput cpre__time-input cpre__time-input">__ : __</div>
      </div>
    </div>
  `;
// const openSubmitHTML = `
// <div class="vr__layout">
//   <div class="vr__wrap">
//     <div class="vr cart__viewer">
//       <div class="vr__close"></div>
//       <div class="vr__contents">
//         <div class="cart">
//           <div class="csform">
//             <div class="cheader">
//               <div class="cheader__back"></div>
//               <div class="cheader__title">Доставка</div>
//               <div class="cheader__close"></div>
//             </div>
//             <div class="csform__content">
//               <div class="cfaddr">
//                 <div class="ctinput__wrap">
//                   <div class="ctinput__caption">Адрес доставки</div>
//                   <div class="ctinput ctinput--multiline ctinput--tick">Не выбран</div>
//                 </div>
//               </div>
//               <div class="cclient">
//                 <div class="ctinput__wrap">
//                   <div class="ctinput__caption">Ваше имя</div>
//                   <input class="ctinput">
//                 </div>
//                 <div class="ctinput__wrap">
//                   <div class="ctinput__caption">Ваш номер телефона</div>
//                   <input type="tel" class="ctinput">
//                 </div>
//               </div>
//               <div class="cpre">
//                 <div class="cpre__types">
//                   <div class="copt">Как можно быстрее</div>
//                   <div class="copt copt--active">Предзаказ</div>
//                 </div>
//                 ${cpre}
//               </div>
//               <div class="cpay">
//                 <div class="cpay__types">
//                   <div class="copt cpay__type copt--active">Картой онлайн</div>
//                 </div>
//                 <div class="ctinput__wrap cpay__merchant">
//                   <div class="ctinput__caption">Выберите карту для оплаты</div>
//                   <div class="ctinput ctinput--tick cpay__merchant-input">Сохранить новую карту</div>
//                 </div>
//               </div>
//               <div class="ctinput__wrap ccm">
//                 <div class="ctinput__caption">Комментарий к заказу</div>
//                 <textarea placeholder="" class="ctinput ccm__textarea--default" style="height: 62px;"></textarea>
//               </div>
//               <div class="cpol">
//                 <div class="ctbox cpol__checkbox"></div>
//                 <div class="cpol__label">Я принимаю условия <a href="/terms/" target="_blank" class="cpol__link">соглашения</a> и правила обработки <a href="/policy" target="_blank" class="auth__boxLink">персональных данных</a></div>
//               </div>
//             </div>
//             <div class="cfooter">
//               <div class="cfooter__total">
//                 <div class="cfooter__left">Итого</div>
//                 <div class="cfooter__right">129,90&nbsp;руб.</div>
//               </div>
//               <button data-text="Далее" class="cfooter__submit btload btload--white">
//                 <i class="btload__ico"></i>
//                 <i class="btload__ico"></i>
//                 <i class="btload__ico"></i>
//               </button>
//             </div>
//           </div>
//         </div>
//       </div>
//     </div>
//   </div>
// </div>`;


function closeModal0() {
    document.querySelectorAll('.vr__layout').forEach(modal => {
        if (!modal.classList.contains('vr__layout--background')) {
            modal.style.opacity = '0';
            modal.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.parentNode.remove();
                }
            }, 300);
            const html = document.documentElement;
            html.classList.remove('vr--show-layout');
            html.classList.remove('vr--prevent-scroll');
        }
    });
}
function closeModal() {
    document.querySelectorAll('.vr__layout').forEach(modal => {
        if (!modal.classList.contains('vr__layout--background')) {
            modal.style.opacity = '0';
            modal.style.transform = 'translateY(-20px)';
            setTimeout(() => {
                if (modal.parentNode) {
                    modal.parentNode.remove();
                }
            }, 300);
            const html = document.documentElement;
            html.classList.remove('vr--show-layout');
            html.classList.remove('vr--prevent-scroll');
        }
    });
    if (document.querySelector('.vr__layout.vr__layout--background')) {
        const modal = document.querySelector('.vr__layout.vr__layout--background');
        const html = document.documentElement;
        html.classList.add('vr--show-layout');
        html.classList.add('vr--prevent-scroll');
        modal.classList.remove('vr__layout--background');
        modal.style.opacity = '1';
        modal.style.transform = 'translateY(0)';
    }
}
function openModal(modalHTML) {
    closeModal0();
    const html = document.documentElement;
    html.classList.add('vr--show-layout');
    html.classList.add('vr--prevent-scroll');
    const modal = document.createElement('div');
    modal.innerHTML = modalHTML;
    document.body.appendChild(modal);
    setTimeout(() => {
        const vrLayout = modal.querySelector('.vr__layout');
        if (vrLayout) {
            vrLayout.style.opacity = '1';
            vrLayout.style.transform = 'translateY(0)';
        }
        const vrLayout2 = document.querySelector('.vr__layout.vr__layout--background');
        if (vrLayout2) {
            vrLayout2.style.opacity = '0';
            vrLayout2.style.transform = 'translateY(-20px)';
        }
    }, 10);
    // const map = L.map('map').setView([55.751244, 37.618423], 11); // Москва по умолчанию

    // // Слой карты (OpenStreetMap)
    // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    //     attribution: '© OpenStreetMap contributors'
    // }).addTo(map);

    // // Добавляем draggable-маркер
    // let marker = L.marker([55.751244, 37.618423], { draggable: true }).addTo(map);

    // // Функция получения адреса через Nominatim (OSM, без ключа)
    // async function getAddress(lat, lon) {
    //     const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ru`;
    //     const res = await fetch(url);
    //     const data = await res.json();
    //     return data.display_name || "Адрес не найден";
    // }

    // // Обновляем поле при перемещении маркера
    // marker.on('dragend', async function () {
    //     const { lat, lng } = marker.getLatLng();
    //     const address = await getAddress(lat, lng);
    //     document.querySelector(".adelivery__field .ainput__text").value = address; // вставляем в "Адрес доставки"
    // });
}


document.addEventListener('click', function (e) {
    if (e.target.closest('.header__user.header__user--anonym') || e.target.closest('.drawer__link.drawer__link--login')) {
        openModal(authModalHTML);
        const checkboxElements = document.querySelectorAll('.auth__boxCheckbox');
        checkboxElements.forEach(function (checkbox) {
            checkbox.addEventListener('click', function () {
                const policyElement = this.closest('.auth__policy');
                if (policyElement) {
                    policyElement.classList.toggle('auth__policy--selected');
                }
            });
        });
    }
    else if (e.target.closest('.header__nav.header__nav--problem') || e.target.closest('.footer__nav.footer__nav--problem')) {
        openModal(reportHTML);
        const checkboxElements = document.querySelectorAll('.ch__boxCheckbox');
        checkboxElements.forEach(function (checkbox) {
            checkbox.addEventListener('click', function () {
                const policyElement = this.closest('.сh__policyWrap');
                if (policyElement) {
                    policyElement.classList.toggle('ch__policy--selected');
                }
            });
        });
    }
    else if (e.target.closest('.header__nav-name.header__phone') || e.target.closest('.hdr__button.hdr__button--phone')) {
        openModal(phoneModalHTML);
        const daysMap = ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"];
        const today = new Date().getDay();
        const todayName = daysMap[today];
        document.querySelectorAll(".mp-tab-contents .mp-time").forEach(el => {
            el.classList.remove("active");
        });
        const todayEl = document.querySelector(`.mp-tab-contents .mp-time[data-week="${todayName}"]`);
        if (todayEl) {
            todayEl.classList.add("active");
        }
    }
    else if (e.target.closest('.dtitle__filters') || e.target.closest('.dtabs__item.dtabs__item--filters')) {
        openModal(filterModalHTML);
    }
    else if (e.target.closest('.ddish__photos') || e.target.closest('.ddish__plus')) {
      // Находим родительский элемент блюда
      const dishElement = e.target.closest('.ddish');

      // Извлекаем данные из data-атрибутов
      const dishId = dishElement.dataset.id;
      const modifiers = JSON.parse(dishElement.dataset.modifiers);
      const description = (() => {
        try { return JSON.parse(dishElement.dataset.description || ''); }
        catch { return ''; }
      })();

      // Находим элементы с информацией о блюде
      const dishName = dishElement.querySelector('.ddish__name a').textContent;
      const dishPrice = dishElement.querySelector('.ddish__sum--final').textContent;
      const dishSize = dishElement.querySelector('.ddish__size').textContent;
      const dishIngredients = dishElement.querySelector('.ddish__ingredients')?.textContent ?? '';
      const dishImage = dishElement.querySelector('.ddish__photo').src;

      // Генерируем модальное окно с подставленными данными
      const foodSelHTML = generateModalHTML({
          id: dishId,
          name: dishName,
          price: dishPrice,
          size: dishSize,
          ingredients: dishIngredients,
          description: description,
          image: dishImage,
          modifiers: modifiers
      });

      openModal(foodSelHTML);
    }
    else if (e.target.closest('.comm__write')) {
        openModal(writeTestimonialHTML);
    }
    else if (e.target.closest('.company__about')) {
        openModal(openAboutMapHTML);
    }
    else if (e.target.closest('.pfee__right')) {
        openModal(openAddressMapHTML);
    }
    else if (e.target.closest('.pfoot__submit.btload.btload--white') || e.target.closest('.pvcart__order.btload.btload--white')) {
        openCheckOut();
    }
    else if (e.target.closest('.cfooter__submit.btload.btload--white.sent')) {
        const formEl = document.querySelector('.csform');
        if (!formEl) return;

        clearFormErrors(formEl);

        const deliveryType = formEl.querySelector('.cpre .copt--active')?.textContent.trim() || '';

        const orders = typeof getOrdersFromCookies === 'function'
            ? getOrdersFromCookies()
            : (() => {
                const name = 'foodOrders=';
                const decoded = decodeURIComponent(document.cookie);
                const part = decoded.split(';').map(s => s.trim()).find(s => s.startsWith(name));
                const raw = part ? part.substring(name.length) : '[]';
                try { return JSON.parse(raw); } catch { return []; }
            })();

        const preorder = (() => {
            if (deliveryType !== 'Предзаказ') return null;

            const dayRaw = formEl.querySelector('.cpre__day-input')?.textContent.trim() || '';
            const timeRaw = formEl.querySelector('.cpre__time-input')?.textContent.trim() || '';
            const time = timeRaw.replace(/\s/g, '');
            return {
                day: dayRaw,
                time: time,
            };
        })();

        const data = {
            type: formEl.querySelector('.cheader__title')?.textContent || '',
            address: formEl.querySelector('input[name="adr"]')?.value.trim() || '',
            name: formEl.querySelector('.cclient .ctinput:not([type="tel"])')?.value.trim() || '',
            phone: formEl.querySelector('.cclient input[type="tel"]')?.value.trim() || '',
            deliveryType,
            preorderDay: preorder?.day || null,
            preorderTime: preorder?.time || null,
            paymentType: formEl.querySelector('.cpay__type.copt--active')?.textContent.trim() || '',
            comment: formEl.querySelector('.ccm textarea')?.value.trim() || '',
            acceptedPolicy: formEl.querySelector('.cpol .ctbox')?.classList.contains('ctbox--selected') || false,
            total: (() => {
                const raw = formEl.querySelector('.cfooter__right')?.textContent || '';
                return raw.replace(/[^\d.,]/g, '').replace(',', '.');
            })(),
            items: orders,
        };

        const errors = validateOrderData(data);
        if (errors.length > 0) {
            renderFormErrors(formEl, errors);
            return;
        }

        (async () => {
            try {
                const resp = await fetch('/api/order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const rjson = await resp.json().catch(() => ({}));
                if (resp.ok && rjson && rjson.success) {
                    openSuccessModal();
                    clearFoodOrders();
                } else {
                  showInlineFormError('Не удалось оформить заказ. Попробуйте ещё раз.')
                }
            } catch (e) {
              showInlineFormError('Ошибка сети. Проверьте подключение.')
            }
        })();
    }
    else if (e.target.closest('.cfooter__submit.btload.btload--white')) {
        if (tabState === 'pickup') {
            openPickup();
        } else {
            openDelivery();
        }
        const checkboxElements = document.querySelectorAll('.ctbox.cpol__checkbox');
        checkboxElements.forEach(function (checkbox) {
            checkbox.addEventListener('click', function () {
                checkbox.classList.toggle('ctbox--selected');
                const policyElements = document.querySelectorAll('.cpol__label');
                policyElements.forEach(function (policyElement) {
                    policyElement.classList.toggle('cpol__label--selected');
                });
            });
        });
    }
    else if (e.target.closest('.hdr__button.hdr__button--search')) {
        openModal(openSearch);
    }
    else if (e.target.closest('.hdr__name.hdr__name--city') || e.target.closest('.drawer__city')) {
        openModal(openCityList);
    }
    else if (e.target.closest('.vr__close') || e.target.closest('.amain__close') || e.target.classList.contains('vr__layout') || (e.target.closest('.cheader__close')) && !e.target.closest('.csform .cheader .cheader__close') && !e.target.closest('.ctmerch .cheader .cheader__close')) {
        closeModal();
    }
    else if (e.target.closest('.csform .cheader .cheader__close')) {
        openCheckOut();
    }
    else if (e.target.closest('.ctmerch .cheader .cheader__close')) {
        openDelivery();
    }
    else if (e.target.closest('.city__item')) {
        const city = e.target.closest('.city__name');
        const headerName = document.querySelector('.hdr__name.hdr__name--city');
        const drawerName = document.querySelector('.drawer__city');
        if (headerName) headerName.textContent = city.textContent;
        if (drawerName) drawerName.textContent = city.textContent;
        closeModal();
    }
});

function validateOrderData(data) {
    const errs = [];
    const phoneOk = /^\+?\d[\d\s\-()]{6,}$/.test(data.phone);
    if (!data.name) errs.push({ field: 'name', message: 'Укажите имя' });
    if (!phoneOk) errs.push({ field: 'phone', message: 'Укажите корректный номер' });
    if (data.type.includes('Доставка') && !data.address) {
        errs.push({ field: 'address', message: 'Укажите адрес доставки' });
    }
    // Минимальный заказ для доставки — 20 руб.
    if (data.type.includes('Доставка')) {
        const itemsSum = (Array.isArray(data.items) ? data.items : []).reduce((s, it) => {
            const q = Number(it?.dish?.quantity || it?.quantity || 1);
            const p = Number(it?.dish?.price || it?.price || 0);
            return s + q * p;
        }, 0);
        if (itemsSum < 20) {
            errs.push({ field: 'items', message: 'Минимальный заказ для доставки — 20 руб.' });
        }
    }
  if (data.deliveryType === 'Предзаказ') {
    if (!data.preorderDay) errs.push({ field: 'preorderDay', message: 'Выберите день' });
    const timeStr = (data.preorderTime || '').toLowerCase();
    const isRange = /^\d{2}:\d{2}/.test(timeStr);
    const isFaster = timeStr.includes('какможнобыстрее');
    if (!(isRange || isFaster)) errs.push({ field: 'preorderTime', message: 'Выберите время' });
  }
    if (!data.acceptedPolicy) errs.push({ field: 'policy', message: 'Необходимо согласие с условиями' });
    if (!Array.isArray(data.items) || data.items.length === 0) errs.push({ field: 'items', message: 'Корзина пуста' });
    return errs;
}

function clearFormErrors(formEl) {
    formEl.querySelectorAll('.ctinput__wrap, .cpre__day, .cpre__time, .cpol').forEach(el => {
        el.classList.remove('ctinput__wrap--error');
        const old = el.querySelector('.ctinput__error');
        if (old) old.remove();
    });
    const footerErr = formEl.querySelector('.cfooter .ctinput__error');
    if (footerErr) footerErr.remove();
}

function markError(container, msg) {
    if (!container) return;
    container.classList.add('ctinput__wrap--error');
    if (!container.querySelector('.ctinput__error')) {
        const div = document.createElement('div');
        div.className = 'ctinput__error';
        div.textContent = msg;
        container.appendChild(div);
    }
}

function renderFormErrors(formEl, errors) {
    errors.forEach(err => {
        if (err.field === 'name') {
            const wrap = formEl.querySelector('.cclient .ctinput__wrap:nth-child(1)');
            markError(wrap, err.message);
        } else if (err.field === 'phone') {
            const wrap = formEl.querySelector('.cclient .ctinput__wrap:nth-child(2)');
            markError(wrap, err.message);
        } else if (err.field === 'address') {
            const wrap = formEl.querySelector('.cfaddr .ctinput__wrap');
            markError(wrap, err.message);
        } else if (err.field === 'preorderDay') {
            const wrap = formEl.querySelector('.cpre__day');
            markError(wrap, err.message);
        } else if (err.field === 'preorderTime') {
            const wrap = formEl.querySelector('.cpre__time');
            markError(wrap, err.message);
        } else if (err.field === 'policy') {
            const wrap = formEl.querySelector('.cpol');
            markError(wrap, err.message);
        } else if (err.field === 'items') {
            const footer = formEl.querySelector('.cfooter');
            if (footer && !footer.querySelector('.ctinput__error')) {
                const div = document.createElement('div');
                div.className = 'ctinput__error';
                div.textContent = err.message;
                footer.insertBefore(div, footer.firstChild);
            }
        }
    });
}

// Временная
function showInlineFormError(message) {
  alert('ОШИБКА: ' + message);
  console.error('Form error:', message);
}

function openSuccessModal() {
    const html1 = `
        <div class="vr__layout">
          <div class="vr__wrap">
            <div class="vr cart__viewer">
              <div class="vr__close"></div>
              <div class="vr__contents">
                <div class="cart">
                  <div class="csuccess">
                    <div class="cheader">
                      <div class="cheader__title">Заявка отправлена</div>
                      <div class="cheader__close"></div>
                    </div>
                    <div class="csuccess__content">
                      <svg class="csuccess__checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                        <circle class="csuccess__checkmark-circle" cx="26" cy="26" r="25" fill="none"/>
                        <path class="csuccess__checkmark-check" fill="none" d="m14.1 27.2l7.1 7.2 16.7-16.8"/>
                      </svg>
                      <div class="csuccess__text">Спасибо за заказ! <br>Мы свяжемся с вами в ближайшее время.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>`;
    openModal(html1);
    
    // Автоматическое закрытие через 5 секунд
    setTimeout(() => {
        closeModal();
    }, 5000);
}


// Функция для генерации HTML модального окна
function generateModalHTML(data) {
    // Генерируем опции модификаторов
    let modifiersHTML = '';

    data.modifiers.forEach(modifier => {
        if (modifier.type === 'many_many') {
            modifiersHTML += `
        <div class="tmod">
          <div class="tmod__title">${modifier.title}</div>
          <div class="tmod__options">
            ${modifier.options.map(option => `
              <div class="topt">
                <img alt="" src="${option.photo}" class="topt__photo">
                <div class="topt__name">
                  <span class="topt__name-wrap">${option.name}, ${option.sizeFormatted}</span>
                  <span class="topt__price">+${option.priceFormatted}</span>
                </div>
                <div class="topt__checkbox"></div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
        }
    });

    return `
    <div class="vr__layout">
      <div class="vr__wrap">
        <div class="vr tp__form">
          <div class="vr__close"></div>
          <div class="vr__contents">
            <div class="tp">
              <div class="tp__imageWrapper">
                <div class="tp__image-wrap lazyload__wrap lazyloaded" data-expand="-1">
                  <img alt="${data.name}" class="tp__image ls-is-cached lazyloaded" src="${data.image}">
                </div>
              </div>
              <div class="tp__content shadow">
                <div class="tsizes">
                  <div class="tsizes__info">
                    <div class="tsizes__info-name">${data.name}</div>
                    <div class="tsizes__info-price">${data.price}<span class="tsizes__info-size">${data.size}</span></div>
                  </div>
                  <div class="ingr__wrap tsizes__ingr">
                    <div class="ingr">${data.ingredients}</div>
                  </div>
                  <div class="tsizes__description">${data.description}</div>
                </div>
                ${modifiersHTML}
                <div class="tp__indicator"></div>
              </div>
              <div class="tsubmit">
                <div class="tsubmit__buttons">
                  <div class="tsubmit__counter">
                    <div class="tsubmit__minus tsubmit__minus--inactive"></div>
                    <div class="tsubmit__count">1</div>
                    <div class="tsubmit__plus"></div>
                  </div>
                  <div class="tsubmit__button" data-id="${data.id}">Добавить к заказу</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>`;
}

document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
        closeModal();
    }
});

// function toggleBackToTop() {
//   const backToTop = document.querySelector('.back-to-top');
//   const footOverLap = document.querySelector('.pfoot');
//   if (window.scrollY > 100) {
//     backToTop.classList.add('back-to-top--visible');
//     if (footOverLap) {
//       footOverLap.classList.remove('pfoot--overlap');
//     }
//   } else {
//     backToTop.classList.remove('back-to-top--visible');
//     if (footOverLap) {
//       footOverLap.classList.add('pfoot--overlap');
//     }
//   }
// }

// function scrollToTop() {
//   window.scrollTo({
//     top: 0,
//     behavior: 'smooth'
//   });
// }

// toggleBackToTop();
// window.addEventListener('scroll', toggleBackToTop);
// document.querySelector('.back-to-top').addEventListener('click', scrollToTop);






document.addEventListener('click', (e) => {
    if (e.target.classList.contains('mp-tab') && !e.target.classList.contains('active')) {
        document.querySelectorAll('.mp-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        document.querySelector('.mp').className = `mp mp-active-${e.target.getAttribute('data-type')}`;
    }
});

const menuBtn = document.querySelector('.hdr__button--menu');
const html = document.documentElement;

// Открытие/закрытие по клику на кнопку
menuBtn.addEventListener('click', function () {
    html.classList.add('drawer--active');
});

// Закрытие по клику вне меню
document.addEventListener('click', function (e) {
    if (((!e.target.closest('.drawer') && !e.target.closest('.hdr__button--menu')) || document.querySelector('.vr__layout')) && html.classList.contains('drawer--active')) {
        html.classList.remove('drawer--active');
    }
});




const contsw = document.querySelector('.cpr .swiper-container');
if (contsw) {
    new Swiper(contsw, {
        direction: 'horizontal',
        slidesPerView: 4,
        spaceBetween: 15,
        grabCursor: true,
        navigation: {
            nextEl: '.cpr__nav--next',
            prevEl: '.cpr__nav--prev',
            disabledClass: 'cpr__nav--disabled'
        },
        allowTouchMove: true,
        breakpoints: {
            // Адаптивность для разных экранов
            320: {
                slidesPerView: 1,
                spaceBetween: 10
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 15
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 15
            }
        }
    });
}

// Инициализация слайдера блюд
const contsw2 = document.querySelector('.topdishes .swiper-container');
if (contsw2) {
    new Swiper(contsw2, {
        direction: 'horizontal',
        slidesPerView: 4,
        spaceBetween: 15,
        grabCursor: true,
        navigation: {
            nextEl: '.topdish__nav--next',
            prevEl: '.topdish__nav--prev',
            disabledClass: 'topdish__nav--disabled'
        },
        allowTouchMove: true,
        breakpoints: {
            // Адаптивность для разных экранов
            320: {
                slidesPerView: 1,
                spaceBetween: 10
            },
            768: {
                slidesPerView: 2,
                spaceBetween: 15
            },
            1024: {
                slidesPerView: 4,
                spaceBetween: 15
            }
        }
    });
}


function initDishRating() {
    const ratingElements = document.querySelectorAll('.topdish__rating');
    if (!ratingElements.length) return;

    // Добавляем обработчики событий
    ratingElements.forEach(element => {
        element.addEventListener('mouseenter', handleMouseEnter);
        element.addEventListener('mouseleave', handleMouseLeave);
        element.addEventListener('click', handleClick);
    });
}

// Статические данные отзывов
const staticReviews = {
    '460739': [
        { mark: 5, userName: 'Влад Макаревич', profileLink: '/profile/id388840/', date: '18.05.2025 13:04', text: '' },
        { mark: 5, userName: 'id512538', profileLink: '/profile/id512538/', date: '17.01.2025 19:55', text: 'Очень вкусно!!!' },
        { mark: 5, userName: 'id513986', profileLink: '/profile/id513986/', date: '13.04.2025 13:29', text: '' },
        { mark: 5, userName: 'Ксюша Ви', profileLink: '/profile/id124216/', date: '21.02.2025 20:06', text: '' }
    ],

    '460745': [
        { mark: 5, userName: 'Влад Макаревич', profileLink: '/profile/id388840/', date: '18.05.2025 13:04', text: '' },
        { mark: 5, userName: 'Виктория Воскресенская', profileLink: '/profile/id572601/', date: '19.04.2025 21:03', text: 'Супер!' },
        { mark: 5, userName: 'id513986', profileLink: '/profile/id513986/', date: '13.04.2025 13:29', text: '' },
        { mark: 5, userName: 'Мори Батьков', profileLink: '/profile/id11728/', date: '07.04.2025 15:28', text: '' },
        { mark: 5, userName: 'Ксюша Ви', profileLink: '/profile/id124216/', date: '21.02.2025 20:06', text: '' },
        { mark: 5, userName: 'id512538', profileLink: '/profile/id512538/', date: '17.01.2025 19:55', text: 'Очень вкусно!!!' },
        { mark: 5, userName: 'Мори Батьков', profileLink: '/profile/id11728/', date: '07.04.2025 15:28', text: '' },
        { mark: 5, userName: 'Мори Батьков', profileLink: '/profile/id11728/', date: '07.04.2025 15:28', text: '' }
    ]
};

// Обработчик наведения мыши
function handleMouseEnter(e) {
    const element = e.currentTarget;
    const dishId = element.dataset.id;

    showTooltip(element, dishId);
}

// Обработчик ухода мыши
function handleMouseLeave(e) {
    // Не скрываем сразу, используем задержку для проверки положения курсора
    setTimeout(() => {
        const tooltip = document.querySelector('[data-tippy-root]');
        if (tooltip) {
            const isOverTooltip = tooltip.matches(':hover') || tooltip.contains(document.activeElement);
            const isOverRating = e.relatedTarget && (e.relatedTarget.classList.contains('topdish__rating') || e.relatedTarget.closest('.topdish__rating'));

            if (!isOverTooltip && !isOverRating) {
                hideTooltip();
            }
        }
    }, 100);
}

// Обработчик клика
function handleClick(e) {
    const element = e.currentTarget;
    const dishId = element.dataset.id;

    const existingTooltip = document.querySelector('[data-tippy-root]');
    if (existingTooltip) {
        hideTooltip();
    } else {
        showTooltip(element, dishId);
    }
}

// Показать тултип с отзывами
function showTooltip(element, dishId) {
    hideTooltip();

    const tooltip = createTooltipElement(dishId, element);
    const topdishes = document.querySelector('.topdishes');
    topdishes.appendChild(tooltip);

    // Добавляем обработчики для самого тултипа
    tooltip.addEventListener('mouseenter', handleTooltipEnter);
    tooltip.addEventListener('mouseleave', handleTooltipLeave);

    positionTooltip(tooltip, element);

    // Показываем с анимацией
    setTimeout(() => {
        tooltip.style.visibility = 'visible';
    }, 10);
}

// Обработчик наведения на тултип
function handleTooltipEnter() {
    // Ничего не делаем - тултип должен оставаться видимым
}

// Обработчик ухода с тултипа
function handleTooltipLeave(e) {
    setTimeout(() => {
        const tooltip = document.querySelector('[data-tippy-root]');
        if (tooltip) {
            const isOverRating = e.relatedTarget && (e.relatedTarget.classList.contains('topdish__rating') || e.relatedTarget.closest('.topdish__rating'));

            if (!isOverRating) {
                hideTooltip();
            }
        }
    }, 100);
}

// Скрыть тултип
function hideTooltip() {
    const tooltip = document.querySelector('[data-tippy-root]');
    if (tooltip) {
        // Удаляем обработчики перед удалением
        tooltip.removeEventListener('mouseenter', handleTooltipEnter);
        tooltip.removeEventListener('mouseleave', handleTooltipLeave);
        tooltip.remove();
    }
}

// Создание элемента тултипа
function createTooltipElement(dishId, referenceElement) {
    const tooltip = document.createElement('div');
    tooltip.setAttribute('data-tippy-root', '');
    tooltip.id = 'tippy-' + Math.floor(Math.random() * 100);
    tooltip.style.cssText = 'z-index: 9999; visibility: hidden; margin: 0px; position: absolute;';

    const reviews = staticReviews[dishId] || [];
    const dishName = referenceElement.closest('.topdish').querySelector('.topdish__name').textContent;

    tooltip.innerHTML = generateReviewsHTML(reviews, dishName);

    return tooltip;
}

// Генерация HTML для отзывов
function generateReviewsHTML(reviews, dishName) {
    if (!reviews.length) {
        return ``;
    }

    let reviewsHTML = '';
    reviews.forEach(review => {
        reviewsHTML += `
          
              <div class="dr__review">
                  <div class="dr__review-header">
                      <i class="dr__mark dr__mark--${review.mark}"></i>
                      <div class="dr__avatar dr__avatar--empty" style=""></div>
                      <a href="${review.profileLink}" class="dr__name">${review.userName}</a>
                      <div class="dr__date">${review.date}</div>
                  </div>
                  ${review.text ? `<div class="dr__text">${review.text}</div>` : ''}
              </div>
          `;
    });

    return `
          <div class="tippy-box" data-state="visible" tabindex="-1" data-theme="dish-rating" data-animation="shift-toward-subtle" role="tooltip" data-placement="left-start" style="max-width: none; transition-duration: 300ms;">
              <div class="tippy-content" data-state="visible" style="transition-duration: 300ms;">
                  <div class="dr">
                      <div class="dr__dish">${dishName}</div>
                      <div class="dr__reviews">${reviewsHTML}</div>
                  </div>
              </div>
          </div>
      `;
}

function positionTooltip(tooltip, referenceElement) {
    const topdishes = document.querySelector('.topdishes');
    if (!topdishes) return;

    // Позиционируем аналогично cityDropdown
    const rect = referenceElement.getBoundingClientRect();
    const topdishesRect = topdishes.getBoundingClientRect();

    // Вычисляем позицию относительно .topdishes (как в cityDropdown)
    const left = rect.left - topdishesRect.left - 15;
    const top = rect.bottom - topdishesRect.top + 5; // 5px отступ снизу

    // Устанавливаем позицию абсолютно относительно .topdishes
    tooltip.style.position = 'absolute';
    tooltip.style.top = top + 'px';
    tooltip.style.left = left + 'px';
    tooltip.style.zIndex = '1000';

    // Убедимся, что .topdishes имеет relative positioning
    if (getComputedStyle(topdishes).position === 'static') {
        topdishes.style.position = 'relative';
    }
}

initDishRating();





















// const navItems = document.querySelectorAll('.cnav__item');
// const navCursor = document.querySelector('.cnav__cursor');
// const menuBlock = document.querySelector('.menu');
// const sections = menuBlock ? menuBlock.querySelectorAll('.sect.nav__anchor') : [];

// if (sections.length === 0 || !menuBlock) {
//     console.log('Не найдены секции меню');
//     return;
// }

// let scrollBusy = false;
// let lastActiveSection = null;

// // Обработчик клика по пункту меню
// navItems.forEach(item => {
//     item.addEventListener('click', function(e) {
//         e.preventDefault();

//         const sectionId = this.getAttribute('data-section');
//         const targetSection = menuBlock.querySelector(`.sect.nav__anchor[data-id="${sectionId}"]`);

//         if (targetSection) {
//             scrollBusy = true;

//             const targetPosition = targetSection.getBoundingClientRect().top + window.pageYOffset;

//             window.scrollTo({
//                 top: targetPosition - 120,
//                 behavior: 'smooth'
//             });

//             updateActiveNavItem(this);

//             setTimeout(() => {
//                 scrollBusy = false;
//             }, 800);
//         }
//     });
// });

// function updateActiveNavItem(activeItem) {
//     navItems.forEach(item => {
//         item.classList.remove('cnav__item--active');
//     });

//     activeItem.classList.add('cnav__item--active');

//     if (navCursor) {
//         const rect = activeItem.getBoundingClientRect();
//         const parentRect = activeItem.parentElement.getBoundingClientRect();

//         navCursor.style.width = `${rect.width}px`;
//         navCursor.style.left = `${rect.left - parentRect.left}px`;
//     }
// }

// // Метод для обработки скролла
// function onScroll() {
//     if (!scrollBusy) {
//         scrollBusy = true;
//         window.requestAnimationFrame(syncNav);
//     }
// }

// // Метод для синхронизации навигации
// function syncNav() {
//     let activeSection = null;
//     let minDistanceToTop = Infinity;

//     sections.forEach(section => {
//         const rect = section.getBoundingClientRect();
//         const distanceToTop = rect.top;

//         // Секция становится активной когда ее верх находится в диапазоне 50-200px от верха
//         if (distanceToTop >= 50 && distanceToTop < 200) {
//             const distanceToIdeal = Math.abs(distanceToTop - 100);
//             if (distanceToIdeal < minDistanceToTop) {
//                 minDistanceToTop = distanceToIdeal;
//                 activeSection = section;
//             }
//         }
//     });

//     // Если не нашли в целевом диапазоне, ищем ближайшую
//     if (!activeSection) {
//         sections.forEach(section => {
//             const rect = section.getBoundingClientRect();
//             const distanceToTop = rect.top;

//             if (distanceToTop < 300 && distanceToTop > -100) {
//                 const distanceToIdeal = Math.abs(distanceToTop - 100);
//                 if (distanceToIdeal < minDistanceToTop) {
//                     minDistanceToTop = distanceToIdeal;
//                     activeSection = section;
//                 }
//             }
//         });
//     }

//     if (activeSection && activeSection !== lastActiveSection) {
//         const sectionId = activeSection.getAttribute('data-id');
//         const correspondingNavItem = document.querySelector(`.cnav__item[data-section="${sectionId}"]`);

//         if (correspondingNavItem) {
//             updateActiveNavItem(correspondingNavItem);
//             lastActiveSection = activeSection;
//         }
//     }

//     scrollBusy = false;
// }

// // Обработчик скролла
// window.addEventListener('scroll', onScroll);

// // Инициализация при загрузке
// setTimeout(() => {
//     let activeSectionFound = false;

//     sections.forEach(section => {
//         const rect = section.getBoundingClientRect();
//         if (rect.top >= 50 && rect.top < 200 && !activeSectionFound) {
//             const sectionId = section.getAttribute('data-id');
//             const correspondingNavItem = document.querySelector(`.cnav__item[data-section="${sectionId}"]`);

//             if (correspondingNavItem) {
//                 updateActiveNavItem(correspondingNavItem);
//                 lastActiveSection = section;
//                 activeSectionFound = true;
//             }
//         }
//     });

//     if (!activeSectionFound && sections.length > 0) {
//         const firstSectionId = sections[0].getAttribute('data-id');
//         const firstNavItem = document.querySelector(`.cnav__item[data-section="${firstSectionId}"]`);

//         if (firstNavItem) {
//             updateActiveNavItem(firstNavItem);
//             lastActiveSection = sections[0];
//         }
//     }
// }, 100);




// Обработчик клика на блок topt
document.addEventListener('click', function (e) {
    handleToptClick(e);
    handleMinusClick(e);
    handlePlusClick(e);
});

function handleToptClick(e) {
    const toptElement = e.target.closest('.topt');
    if (!toptElement) return;

    // Проверяем, не кликнули ли на элементы внутри manybox
    if (e.target.closest('.topt__manybox')) {
        return;
    }

    if (!toptElement.classList.contains('topt--selected')) {
        selectTopt(toptElement);
    } else {
        incrementCount(toptElement);
    }
}

function handleMinusClick(e) {
    if (!e.target.classList.contains('topt__manybox-minus')) return;

    const manybox = e.target.closest('.topt__manybox');
    const toptElement = e.target.closest('.topt');
    const countElement = manybox.querySelector('.topt__manybox-count');

    let count = parseInt(countElement.textContent);

    if (count > 1) {
        countElement.textContent = count - 1;
    } else {
        deselectTopt(toptElement);
    }
}

function handlePlusClick(e) {
    if (!e.target.classList.contains('topt__manybox-plus')) return;

    const manybox = e.target.closest('.topt__manybox');
    const countElement = manybox.querySelector('.topt__manybox-count');

    let count = parseInt(countElement.textContent);
    countElement.textContent = count + 1;
}

function selectTopt(toptElement) {
    toptElement.classList.add('topt--selected');

    // Удаляем checkbox
    const checkbox = toptElement.querySelector('.topt__checkbox');
    if (checkbox) {
        checkbox.remove();
    }

    // Создаем manybox
    const manybox = document.createElement('div');
    manybox.className = 'topt__manybox';
    manybox.innerHTML = `
            <div class="topt__manybox-minus"></div>
            <div class="topt__manybox-count">1</div>
            <div class="topt__manybox-plus"></div>
        `;

    toptElement.appendChild(manybox);
}

function deselectTopt(toptElement) {
    const manybox = toptElement.querySelector('.topt__manybox');
    if (manybox) {
        manybox.remove();
    }

    // Создаем checkbox
    const checkbox = document.createElement('div');
    checkbox.className = 'topt__checkbox';
    toptElement.appendChild(checkbox);

    toptElement.classList.remove('topt--selected');
}

function incrementCount(toptElement) {
    const countElement = toptElement.querySelector('.topt__manybox-count');
    if (countElement) {
        let count = parseInt(countElement.textContent);
        countElement.textContent = count + 1;
    }
}




document.querySelectorAll('.tsubmit').forEach(block => {
    const count = parseInt(block.querySelector('.tsubmit__count').textContent);
    const minusBtn = block.querySelector('.tsubmit__minus');
    minusBtn.classList.toggle('tsubmit__minus--inactive', count <= 1);
});

// Обработчик кликов
document.addEventListener('click', function (e) {
    const submitBlock = e.target.closest('.tsubmit');
    if (!submitBlock) return;

    const countElement = submitBlock.querySelector('.tsubmit__count');
    const minusBtn = submitBlock.querySelector('.tsubmit__minus');
    let count = parseInt(countElement.textContent);

    if (e.target.classList.contains('tsubmit__plus')) {
        // Увеличиваем счетчик
        countElement.textContent = count + 1;
        minusBtn.classList.toggle('tsubmit__minus--inactive', count + 1 <= 1);
    }
    else if (e.target.classList.contains('tsubmit__minus') &&
        !e.target.classList.contains('tsubmit__minus--inactive')) {
        // Уменьшаем счетчик (только если кнопка активна)
        countElement.textContent = count - 1;
        minusBtn.classList.toggle('tsubmit__minus--inactive', count - 1 <= 1);
    }
});






let currentTabState = 'delivery'; // delivery или pickup

document.addEventListener('click', function (e) {
    if (e.target.classList.contains('tsubmit__button')) {
        addDishToOrder(e.target);
    }
});

function addDishToOrder(button) {
    const dishContainer = button.closest('.vr__layout');
    if (!dishContainer) {
        console.error('Не найден контейнер блюда');
        return;
    }

    const dishData = extractDishData(dishContainer);
    const toppingsData = extractToppingsData(dishContainer);

    // Сохраняем базовое блюдо как отдельную позицию
    const baseDishItem = {
        dish: {
            name: dishData.name,
            price: dishData.price,
            weight: dishData.weight,
            quantity: dishData.quantity,
            imageUrl: dishData.imageUrl
        },
        toppings: []
    };
    saveToCookies(baseDishItem);

    // Для каждой начинки создаем отдельную позицию (учитывая количество)
    toppingsData.forEach(topping => {
        const toppingItem = {
            dish: {
                name: topping.name,
                price: topping.price,
                weight: 0,
                quantity: topping.quantity,
                imageUrl: topping.imageUrl || ''
            },
            toppings: []
        };
        saveToCookies(toppingItem);
    });
    closeModal();
    initCart();
}

function extractDishData(container) {
    const nameElement = container.querySelector('.tsizes__info-name');
    const priceElement = container.querySelector('.tsizes__info-price');
    const sizeElement = container.querySelector('.tsizes__info-size');
    const countElement = container.querySelector('.tsubmit__count');
    const imageElement = container.querySelector('.tp__image'); // Ищем изображение

    const name = nameElement ? nameElement.textContent.trim() : 'Неизвестное блюдо';

    let price = 0;
    if (priceElement) {
        const priceText = priceElement.textContent;
        const priceMatch = priceText.match(/([\d,]+)\s*руб/);
        if (priceMatch) {
            price = parseFloat(priceMatch[1].replace(',', '.'));
        }
    }

    let weight = 0;
    if (sizeElement) {
        const sizeText = sizeElement.textContent;
        weight = parseInt(sizeText.replace(/[^\d]/g, ''));
    }

    let quantity = 1;
    if (countElement) {
        quantity = parseInt(countElement.textContent);
    }

    // Добавляем получение ссылки на изображение
    let imageUrl = '';
    if (imageElement) {
        imageUrl = imageElement.getAttribute('src') || '';
        // Если src пустой, проверяем data-src или другие атрибуты
        if (!imageUrl) {
            imageUrl = imageElement.getAttribute('data-src') ||
                imageElement.getAttribute('data-original') || '';
        }
    }

    return {
        name: name,
        price: price,
        weight: weight,
        quantity: quantity,
        imageUrl: imageUrl
    };
}

function extractToppingsData(container) {
    const toppings = [];
    const selectedToppings = container.querySelectorAll('.topt.topt--selected');

    selectedToppings.forEach(topping => {
        const nameElement = topping.querySelector('.topt__name-wrap');
        const priceElement = topping.querySelector('.topt__price');
        const countElement = topping.querySelector('.topt__manybox-count');
        const photoElement = topping.querySelector('.topt__photo');

        let name = 'Неизвестная начинка';
        if (nameElement) {
            name = nameElement.textContent.trim(); // сохраняем граммовку
        }

        let price = 0;
        if (priceElement) {
            const priceText = priceElement.textContent;
            const priceMatch = priceText.match(/[\d,]+/);
            if (priceMatch) {
                price = parseFloat(priceMatch[0].replace(',', '.'));
            }
        }

        let quantity = 1;
        if (countElement) {
            quantity = parseInt(countElement.textContent);
        }

        let imageUrl = '';
        if (photoElement) {
            imageUrl = photoElement.getAttribute('src') || '';
            if (!imageUrl) {
                imageUrl = photoElement.getAttribute('data-src') || photoElement.getAttribute('data-original') || '';
            }
        }

        toppings.push({
            name: name,
            price: price,
            quantity: quantity,
            imageUrl: imageUrl
        });
    });

    return toppings;
}

function saveToCookies(orderItem) {
    const existingOrders = getOrdersFromCookies();
    existingOrders.push(orderItem);
    const ordersJSON = JSON.stringify(existingOrders);
    document.cookie = `foodOrders=${encodeURIComponent(ordersJSON)}; path=/; max-age=${60 * 60 * 24 * 7}`;
}

function getOrdersFromCookies() {
    const name = 'foodOrders=';
    const decodedCookie = decodeURIComponent(document.cookie);
    const ca = decodedCookie.split(';');

    for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') {
            c = c.substring(1);
        }
        if (c.indexOf(name) === 0) {
            const ordersJSON = c.substring(name.length, c.length);
            try {
                return JSON.parse(ordersJSON) || [];
            } catch (e) {
                console.error('Error parsing orders from cookie:', e);
                return [];
            }
        }
    }
    return [];
}

// function closeModal() {
//     const modal = document.querySelector('.vr__layout');
//     if (modal) {
//         modal.remove();
//     }
//     // Восстанавливаем скролл
//     document.body.style.overflow = 'auto';
//     document.body.style.position = 'static';
// }

// Обработчик для кнопки закрытия
document.addEventListener('click', function (e) {
    if (e.target.classList.contains('vr__close')) {
        closeModal();
    }
});

window.getFoodOrders = function () {
    return getOrdersFromCookies();
};

window.clearFoodOrders = function () {
    document.cookie = 'foodOrders=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT';
    initCart();
};

function initCart() {
    const comright = document.querySelector('.company__right');
    if (!comright) return;
    const orders = getOrdersFromCookies();
    if (orders.length === 0) {
        comright.innerHTML = ``;
    } else {
        let totalAmount = 0;
        orders.forEach((order) => {
            const dish = order.dish;
            const dishTotalPrice = dish.price * dish.quantity;
            totalAmount += dishTotalPrice;
        });
        comright.innerHTML = `
      <div class="pvcart">
        <div data-text="Оформить заказ на ${totalAmount.toFixed(2)} руб." class="pvcart__order btload btload--white">
          <i class="btload__ico"></i>
          <i class="btload__ico"></i>
          <i class="btload__ico"></i>
        </div>
      </div>
      `;
    }
}

let tabState = 'delivery';
function openCheckOut() {
    let dishesHTML = '';
    let totalAmount = 0;
    const orders = getOrdersFromCookies();
    if (orders.length !== 0) {
        orders.forEach((order, index) => {
            const dish = order.dish;
            const dishTotalPrice = dish.price * dish.quantity;
            totalAmount += dishTotalPrice;

            let displayName = dish.name;
            let displaySize = '';
            if (dish.weight) {
                displaySize = `${dish.weight} г`;
            } else {
                const gramsMatch = displayName.match(/,\s*(\d+)\s*г$/i);
                if (gramsMatch) {
                    displaySize = `${gramsMatch[1]} г`;
                    displayName = displayName.replace(/,\s*\d+\s*г$/i, '').trim();
                }
            }

            dishesHTML += `
          <div class="cdish cdish--with-photo" data-index="${index}">
            <img src="${dish.imageUrl || '/img/log0.png'}" class="cdish__photo">
            <div class="cdish__name">${displayName}
              ${displaySize ? `<span class=\"cdish__size\">${displaySize}</span>` : ''}
            </div>
            <div class="cdish__meta">
              <div class="cdish__controls">
                <div class="cdish__control cdish__control--minus"></div>
                <div class="cdish__num">${dish.quantity}</div>
                <div class="cdish__control cdish__control--plus"></div>
              </div>
              <div class="cdish__price">${dishTotalPrice.toFixed(2)} руб.</div>
            </div>
          </div>
        `;
        });
    } else {
        closeModal();
    }
    const isDel = tabState === 'delivery';
    const checkOutHTML = `
      <div classs="csdishes">
        <div class="cheader">
          <div class="cheader__title">180 градусов</div>
          <div class="cheader__trash"></div>
          <div class="cheader__close"></div>
        </div>
        <div class="csdishes__content">
          <div class="cdv">
            <div class="cdv__item ${isDel ? 'cdv__item--active' : 'cdv__item--hoverable'}" style="width: calc(50%);">
              <div class="cdv__name">Доставка</div>
              <div class="cdv__pointer" style="transform: ${isDel ? 'translateX(0%)' : 'translateX(100%)'};"></div>
            </div>
            <div class="cdv__item ${isDel ? 'cdv__item--hoverable' : 'cdv__item--active'}" style="width: calc(50%);">
              <div class="cdv__name">Навынос</div>
            </div>
          </div>
          <div class="cdishes">
            ${dishesHTML}
          </div>
          <div class="cextra">
            <div class="cextra__header">Добавить к заказу?</div>
            <div class="cextra__scrollable swiper">
              <div class="swiper-wrapper">
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/14/350dc4bc041bf670683247bc106fc5---png_240x200_0e9ef_convert.png" class="cextra__photo">
                  <div class="cextra__name">Моцарелла</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/c02557a3b42db9f5f45a395e1ae86c---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Куриное филе</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/fce07c97ffd86d5f0ac575d191f0a2---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Сыр творожный</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/c8a0acd97db934c7d28b74cef6c26a---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Охотничьи колбаски</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/15f0c426496be7d3c433091e9946e3---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Ветчина</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/bdad7ac346f6e9f690fe3ca6e4e0e8---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Филе красной рыбы</div>
                  <div class="cextra__price">1,20&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/e36556b05338bd99a8de9a6849623c---png_240x200_0e9ef_convert.png" class="cextra__photo">
                  <div class="cextra__name">Пеперони</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/2335ed67fa5343af928826cde9d061---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Шоколад</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/2ad9e1563d2ac29d3de836b99b45af---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Вишнёвый джем</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/ed9663a515b8e75d167333ccfcf33a---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Клубничный джем</div>
                  <div class="cextra__price">0,70&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/3ec54301b6c0d99945c989a4624596---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Горчичный»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/6092b2cd858512c0912bd1c1d86157---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Сырный»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/9ca58e73b435afd870cad870dc8b06---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Тартар»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/f6019cebda432579616c514bd7506f---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «1000 островов»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/2df49890e51b1ba5f725a596093962---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Сладкий Чили»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/42bd4640beac3ed9474946290e7add---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Барбекю»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/3b26c8ea968c907464304d340d6a3d---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Кетчуп»</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/96f37619c04fcf566c0ca73e240fa7---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Огурчики маринованные</div>
                  <div class="cextra__price">0,30&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/07fc538593b0ea620bfc57c4a1df18---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Зелень</div>
                  <div class="cextra__price">0,60&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/04/16/553bc597b242baa6525be627e0b0ca---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Перец Халапеньо</div>
                  <div class="cextra__price">0,60&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/09/26/ee162a5cbd9a090035b864f0341983---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Шаурма»</div>
                  <div class="cextra__price">0,20&nbsp;руб.</div>
                </div>
                <div class="cextra__item">
                  <img src="https://cdn.clever.by/assets/2025/09/26/02399f1a548e824cd663588e7195d8---jpg_240x200_0e9ef_convert.jpg" class="cextra__photo">
                  <div class="cextra__name">Соус «Бургер»</div>
                  <div class="cextra__price">0,40&nbsp;руб.</div>
                </div>
              </div>
              <div class="swiper-scrollbar"></div>
            </div>
          </div>
        </div>
        <div class="cfooter cfooter--overlap">
          <div class="cfooter__total">
            <div class="cfooter__left">Итого</div>
            <div class="cfooter__right">${totalAmount.toFixed(2)} руб.</div>
          </div>
          <button data-text="Далее" class="cfooter__submit btload btload--white">
            <i class="btload__ico"></i>
            <i class="btload__ico"></i>
            <i class="btload__ico"></i>
          </button>
        </div>
      </div>
    `;
    const cart = document.querySelector('.cart');
    if (cart) {
      cart.innerHTML = checkOutHTML;
      try { const extraCont = document.querySelector('.cextra__scrollable'); if (extraCont && !extraCont.swiper) { new Swiper(extraCont, { slidesPerView: 3.8, spaceBetween: 0, freeMode: true, slideClass: 'cextra__item', wrapperClass: 'swiper-wrapper', scrollbar: { el: '.cextra .swiper-scrollbar', draggable: true }, breakpoints: { 768: { slidesPerView: 3.8 }, 1024: { slidesPerView: 3.8 } } }); } } catch (e) { }
    } else {
        const openCheckOutHTML = `
        <div class="vr__layout">
          <div class="vr__wrap">
            <div class="vr cart__viewer">
              <div class="vr__close"></div>
              <div class="vr__contents">
                <div class="cart">
                  ${checkOutHTML};
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
        openModal(openCheckOutHTML);
      try { const extraCont = document.querySelector('.cextra__scrollable'); if (extraCont && !extraCont.swiper) { new Swiper(extraCont, { slidesPerView: 3.8, spaceBetween: 0, freeMode: true, slideClass: 'cextra__item', wrapperClass: 'swiper-wrapper', scrollbar: { el: '.cextra .swiper-scrollbar', draggable: true }, breakpoints: { 768: { slidesPerView: 3.8 }, 1024: { slidesPerView: 3.8 } } }); } } catch (e) { }

    }
}


document.addEventListener('click', function (e) {
    const trashBtn = e.target.closest('.cheader__trash');
    if (trashBtn) {
        if (confirm('Очистить всю корзину?')) {
            clearFoodOrders();
            closeModal();
        }
    }
});

document.addEventListener('click', function (e) {
    const btn = e.target.closest('.cdish__control.cdish__control--plus');
    if (btn) {
        const dishElement = btn.closest('.cdish.cdish--with-photo');
        const index = parseInt(dishElement.dataset.index);
        increaseDishQuantity(index);
        openCheckOut();
    }
});

document.addEventListener('click', function (e) {
    const btn = e.target.closest('.cdish__control.cdish__control--minus');
    if (btn) {
        const dishElement = btn.closest('.cdish.cdish--with-photo');
        const index = parseInt(dishElement.dataset.index);
        decreaseDishQuantity(index);
        openCheckOut();
    }
});

document.addEventListener('click', function (e) {
    const pdvItem = e.target.closest('.cdv__item');
    if (pdvItem && pdvItem.classList.contains('cdv__item--hoverable')) {
        handleCdvClick(pdvItem);
    }
});


function openDelivery() {
    let totalAmount = 0;
    const orders = getOrdersFromCookies();
    if (orders.length !== 0) {
        orders.forEach((order) => {
            const dish = order.dish;
            const dishTotalPrice = dish.price * dish.quantity;
            totalAmount += dishTotalPrice;
        });
        const deliveryFee = totalAmount >= 40 ? 0 : 8;
        const finalTotal = (totalAmount + deliveryFee).toFixed(2);
        const cart = document.querySelector('.cart');
        cart.innerHTML = `
        <div class="csform">
          <div class="cheader">
            <div class="cheader__back"></div>
            <div class="cheader__title">Доставка</div>
            <div class="cheader__close"></div>
          </div>
          <div class="csform__content">
            <div class="cfaddr">
              <div class="ctinput__wrap">
                <div class="ctinput__caption">Адрес доставки</div>
                <input type="text" name="adr" class="ctinput">
              </div>
            </div>
            <div class="cclient">
              <div class="ctinput__wrap">
                <div class="ctinput__caption">Ваше имя</div>
                <input class="ctinput">
              </div>
              <div class="ctinput__wrap">
                <div class="ctinput__caption">Ваш номер телефона</div>
                <input type="tel" class="ctinput" value="+375">
              </div>
            </div>
            <div class="cpre">
              <div class="cpre__types">
                <div class="copt">Как можно быстрее</div>
                <div class="copt copt--active">Предзаказ</div>
              </div>
              ${cpre}
            </div>
            <div class="cpay">
              <div class="cpay__types">
                <div class="copt cpay__type copt--active">Картой</div>
                <div class="copt cpay__type">Наличными</div>
              </div>
            </div>
            <div class="ctinput__wrap ccm">
              <div class="ctinput__caption">Комментарий к заказу</div>
              <textarea placeholder="" class="ctinput ccm__textarea--default" style="height: 62px;"></textarea>
            </div>
            <div class="cpol">
              <div class="ctbox cpol__checkbox ctbox--selected"></div>
              <div class="cpol__label cpol__label--selected">Я принимаю условия <a href="/terms/" target="_blank" class="cpol__link">соглашения</a> и правила обработки <a href="/policy" target="_blank" class="auth__boxLink">персональных данных</a></div>
            </div>
          </div>
          <div class="cfooter">
            <div class="cfooter__total">
              <div class="cfooter__meta">${deliveryFee === 0 ? 'Доставка бесплатно от 40 руб.' : 'Стоимость доставки — 8 руб.'}</div>
            </div>
            <div class="cfooter__total">
              <div class="cfooter__left">Итого</div>
              <div class="cfooter__right">${finalTotal} руб.</div>
            </div>
            <button data-text="Отправить" class="cfooter__submit btload btload--white sent">
              <i class="btload__ico"></i>
              <i class="btload__ico"></i>
              <i class="btload__ico"></i>
            </button>
          </div>
        </div>
      `;
    }
}
function openPickup() {
    let totalAmount = 0;
    const orders = getOrdersFromCookies();
    if (orders.length !== 0) {
        orders.forEach((order) => {
            const dish = order.dish;
            const dishTotalPrice = dish.price * dish.quantity;
            totalAmount += dishTotalPrice;
        });
        const cart = document.querySelector('.cart');
        cart.innerHTML = `
          <div class="csform">
            <div class="cheader">
              <div class="cheader__back"></div>
              <div class="cheader__title">Навынос</div>
              <div class="cheader__close"></div>
            </div>
            <div class="csform__content">
              <div class="cclient">
                <div class="ctinput__wrap">
                  <div class="ctinput__caption">Ваше имя</div>
                  <input class="ctinput">
                </div>
                <div class="ctinput__wrap">
                  <div class="ctinput__caption">Ваш номер телефона</div>
                  <input type="tel" class="ctinput" value="+375">
                </div>
              </div>
              <div class="cpre">
                <div class="cpre__types">
                  <div class="copt">Как можно быстрее</div>
                  <div class="copt copt--active">Предзаказ</div>
                </div>
                ${cpre}
              </div>
              <div class="cpay">
                <div class="cpay__types">
                  <div class="copt cpay__type copt--active">Картой</div>
                  <div class="copt cpay__type">Наличными</div>
                </div>
              </div>
              <div class="ctinput__wrap ccm">
                <div class="ctinput__caption">Комментарий к заказу</div>
                <textarea placeholder="" class="ctinput ccm__textarea--default" style="height: 62px;"></textarea>
              </div>
              <div class="cpol">
                <div class="ctbox cpol__checkbox ctbox--selected"></div>
                <div class="cpol__label cpol__label--selected">Я принимаю условия <a href="/terms/" target="_blank" class="cpol__link">соглашения</a> и правила обработки <a href="/policy" target="_blank" class="auth__boxLink">персональных данных</a></div>
              </div>
            </div>
            <div class="cfooter">
              <div class="cfooter__total">
                <div class="cfooter__left">Итого</div>
                <div class="cfooter__right">${totalAmount.toFixed(2)} руб.</div>
              </div>
              <button data-text="Отправить" class="cfooter__submit btload btload--white sent">
                <i class="btload__ico"></i>
                <i class="btload__ico"></i>
                <i class="btload__ico"></i>
              </button>
            </div>
          </div>
        `;
    }
}


document.addEventListener('click', function (e) {
    const coptItem = e.target.closest('.copt');
    if (coptItem) {
        handleCoptClick(coptItem);
    }
});

document.addEventListener('click', function (e) {
    if (e.target.closest('.ctinput.ctinput--multiline.ctinput--tick') || e.target.closest('.cfee__right')) {
        const form = document.querySelector('.vr__layout');
        form.classList.add('vr__layout--background');
        openModal(openAddressMapHTML);
    }
});

document.addEventListener('click', function (e) {
    const day = e.target.closest('.ctinput.ctinput--tick.cpre__day-input');
    const time = e.target.closest('.ctinput.cpre__time-input.cpre__time-input');
    const csugg0 = document.querySelector('.csugg');
    if (day) {
        const wrap = day.closest('.ctinput__wrap.cpre__day');
        const csugg = wrap.querySelector('.csugg');
        if (csugg0) {
            const allCsugg = document.querySelectorAll('.csugg');
            allCsugg.forEach(csugg => csugg.remove());
        }
        if (!csugg) {
            function getDateOptions() {
                const today = new Date();
                const options = [];
                const todayStr = today.toLocaleDateString('ru-RU', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'long'
                });
                options.push({
                    id: today.toISOString().split('T')[0],
                    text: 'Сегодня'
                });
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                const tomorrowStr = tomorrow.toLocaleDateString('ru-RU', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'long'
                });
                options.push({
                    id: tomorrow.toISOString().split('T')[0],
                    text: 'Завтра'
                });
                for (let i = 2; i <= 3; i++) {
                    const futureDate = new Date(today);
                    futureDate.setDate(futureDate.getDate() + i);
                    const dateStr = futureDate.toLocaleDateString('ru-RU', {
                        weekday: 'short',
                        day: 'numeric',
                        month: 'long'
                    });
                    options.push({
                        id: futureDate.toISOString().split('T')[0],
                        text: dateStr
                    });
                }
                return options;
            }
            const dateOptions = getDateOptions();
            const csuggHTML = `
          <div class="csugg">
            <div class="csugg__scrollable">
              ${dateOptions.map(option =>
                `<div data-id="${option.id}" class="csugg__option">${option.text}</div>`
            ).join('')}
            </div>
          </div>
        `;
            wrap.insertAdjacentHTML('beforeend', csuggHTML);
            optionClick();
        } else {
            const allCsugg = document.querySelectorAll('.csugg');
            allCsugg.forEach(csugg => csugg.remove());
        }
    } else if (time) {
        const wrap = time.closest('.ctinput__wrap.cpre__time');
        const csugg = wrap.querySelector('.csugg');
        if (csugg0) {
            const allCsugg = document.querySelectorAll('.csugg');
            allCsugg.forEach(csugg => csugg.remove());
        }
      if (!csugg) {
        function pad2(n) { return n < 10 ? ('0' + n) : ('' + n) }
        function formatHM(totalMin) { const h = Math.floor(totalMin / 60); const m = totalMin % 60; return pad2(h) + ":" + pad2(m) }
        const OPEN_MIN = 12 * 60; // 12:00
        const CLOSE_END_MIN = 20 * 60 + 15; // last window ends 20:15
        const dayInputEl = document.querySelector('.ctinput.ctinput--tick.cpre__day-input');
        const dayLabel = dayInputEl ? dayInputEl.textContent.trim().toLowerCase() : '';
        const now = new Date();
        let startMin = OPEN_MIN;
        if (dayLabel === 'сегодня') {
          const nowMin = now.getHours() * 60 + now.getMinutes();
          // round up to next 15-minute mark
          const rounded = Math.ceil(nowMin / 15) * 15;
          startMin = Math.max(OPEN_MIN, rounded);
        } else {
          // tomorrow or any future date: do not adjust by current time
          startMin = OPEN_MIN;
        }
        // Ensure there is at least one slot: if start exceeds last possible start, clamp
        const lastStartMin = CLOSE_END_MIN - 30; // 30-minute window
        if (startMin > lastStartMin) startMin = lastStartMin;
        let optionsHTML = '';
        if (dayLabel === 'сегодня') {
          const nowMin = now.getHours() * 60 + now.getMinutes();
          if (nowMin < OPEN_MIN) {
            optionsHTML += '              <div data-id="12:00 faster" class="csugg__option">\n' +
              '                  Как можно быстрее после открытия\n' +
              '              </div>\n';
          }
        }
        for (let t = startMin; t <= lastStartMin; t += 15) {
          const from = formatHM(t);
          const to = formatHM(t + 30);
          optionsHTML += '              <div data-id="' + from + ' - ' + to + '" class="csugg__option">\n' +
            '                  ' + from + ' - ' + to + '\n' +
            '              </div>\n';
        }
        const csuggHTML = `
          <div class="csugg">
            <div class="csugg__scrollable" >
${optionsHTML}            </div>
          </div>
        `;
        wrap.insertAdjacentHTML('beforeend', csuggHTML);
        optionClick();
      } else {
            const allCsugg = document.querySelectorAll('.csugg');
            allCsugg.forEach(csugg => csugg.remove());
        }
    }
});


function optionClick() {
    document.addEventListener('click', function (e) {
        const option = e.target.closest('.ctinput__wrap.cpre__day .csugg .csugg__option');
        const option1 = e.target.closest('.ctinput__wrap.cpre__time .csugg .csugg__option');
        if (option) {
            const selectedText = option.textContent;
            const csugg = option.closest('.csugg');
            const wrap = csugg.closest('.ctinput__wrap.cpre__day');
            const dayInput = wrap.querySelector('.ctinput.ctinput--tick.cpre__day-input');
            dayInput.textContent = selectedText;
            csugg.remove();
        } else if (option1) {
            const selectedText = option1.textContent;
            const csugg = option1.closest('.csugg');
            const wrap = csugg.closest('.ctinput__wrap.cpre__time');
            const timeInput = wrap.querySelector('.ctinput.cpre__time-input.cpre__time-input');
            timeInput.textContent = selectedText;
            csugg.remove();
        }
    });
}

document.addEventListener('click', function (e) {
    if (!e.target.closest('.ctinput.ctinput--tick.cpre__day-input') && !e.target.closest('.ctinput.cpre__time-input.cpre__time-input') && !e.target.closest('.csugg')) {
        const allCsugg = document.querySelectorAll('.csugg');
        allCsugg.forEach(csugg => csugg.remove());
    }
});

document.addEventListener('click', function (e) {
    const priceBtn = e.target.closest('.cextra__price');
    if (priceBtn) {
        const dishContainer = priceBtn.closest('.cextra__item');
        if (!dishContainer) {
            console.error('Не найден контейнер блюда');
            return;
        }
        const dishData = extractDishData2(dishContainer);
        const toppingsData = extractToppingsData(dishContainer);
        let totalDishPrice = dishData.price;
        toppingsData.forEach(topping => {
            totalDishPrice += topping.price * topping.quantity;
        });
        const orderItem = {
            dish: {
                name: dishData.name,
                price: totalDishPrice,
                weight: dishData.weight,
                quantity: dishData.quantity,
                imageUrl: dishData.imageUrl
            },
            toppings: toppingsData.map(topping => ({
                name: topping.name,
                quantity: topping.quantity,
                price: topping.price
            }))
        };
        saveToCookies(orderItem);
        initCart();
        openCheckOut();
    }
});

document.addEventListener('click', function (e) {
    const btn = e.target.closest('.csform .cheader .cheader__back');
    if (btn) {
        openCheckOut();
    }
});

document.addEventListener('click', function (e) {
    const btn = e.target.closest('.ctinput.ctinput--tick.cpay__merchant-input');
    if (btn) {
        const cart = document.querySelector('.cart');
        cart.innerHTML = `
        <div class="ctmerch">
          <div class="cheader">
            <div class="cheader__back"></div>
            <div class="cheader__title">Платёжная карта</div>
            <div class="cheader__close"></div>
          </div>
          <div class="ctmerch__content">
            <div class="cmtype">
              <div class="cmtype__radio cmtype__radio--selected"></div>
              <div class="cmtype__wrap">
                <span class="cmtype__name">Сохранить новую карту</span>
              </div>
              <div class="cmtype__options"></div>
            </div>
            <div class="cmtype">
              <div class="cmtype__radio"></div>
              <div class="cmtype__wrap">
                <span class="cmtype__name">Не сохранять карту</span>
              </div>
              <div class="cmtype__options"></div>
            </div>
          </div>
        </div>
      `;
    }
});

document.addEventListener('click', function (e) {
    const btn = e.target.closest('.ctmerch .cheader .cheader__back');
    if (btn) {
        openDelivery();
    }
});


function extractDishData2(container) {
    const nameElement = container.querySelector('.cextra__name');
    const priceElement = container.querySelector('.cextra__price');
    const imageElement = container.querySelector('.cextra__photo');
    const name = nameElement ? nameElement.textContent.trim() : 'Неизвестное блюдо';
    let price = 0;
    if (priceElement) {
        const priceText = priceElement.textContent;
        const priceMatch = priceText.match(/([\d,]+)\s*руб/);
        if (priceMatch) {
            price = parseFloat(priceMatch[1].replace(',', '.'));
        }
    }
    let weight = 10;
    let quantity = 1;
    let imageUrl = '';
    if (imageElement) {
        imageUrl = imageElement.getAttribute('src') || '';
        if (!imageUrl) {
            imageUrl = imageElement.getAttribute('data-src') || imageElement.getAttribute('data-original') || '';
        }
    }
    return {
        name: name,
        price: price,
        weight: weight,
        quantity: quantity,
        imageUrl: imageUrl
    };
}

function addCartEventListeners() {
    const trashBtn = document.querySelector('.phead__trash');
    if (trashBtn) {
        trashBtn.addEventListener('click', function () {
            if (confirm('Очистить всю корзину?')) {
                clearFoodOrders();
            }
        });
    }

    document.querySelectorAll('.pdish__button--plus').forEach(btn => {
        btn.addEventListener('click', function () {
            const dishElement = this.closest('.pdish');
            const index = parseInt(dishElement.dataset.index);
            increaseDishQuantity(index);
        });
    });

    document.querySelectorAll('.pdish__button--minus').forEach(btn => {
        btn.addEventListener('click', function () {
            const dishElement = this.closest('.pdish');
            const index = parseInt(dishElement.dataset.index);
            decreaseDishQuantity(index);
        });
    });

    // Делегирование событий для переключения доставки/самовывоза
    document.addEventListener('click', function (e) {
        const pdvItem = e.target.closest('.pdv__item');
        if (pdvItem && pdvItem.classList.contains('pdv__item--hoverable')) {
            handlePdvClick(pdvItem);
        }
    });
}

function handlePdvClick(clickedItem) {
    const pdvItems = document.querySelectorAll('.pdv__item');
    const pdvPointer = document.querySelector('.pdv__pointer');
    const pfeeBlock = document.querySelector('.pfee');

    const index = Array.from(pdvItems).indexOf(clickedItem);
    const isSecondItem = index === 1;

    // Сохраняем состояние таба
    currentTabState = isSecondItem ? 'pickup' : 'delivery';

    // Меняем классы у элементов
    pdvItems[0].classList.toggle('pdv__item--active', !isSecondItem);
    pdvItems[0].classList.toggle('pdv__item--hoverable', isSecondItem);

    pdvItems[1].classList.toggle('pdv__item--active', isSecondItem);
    pdvItems[1].classList.toggle('pdv__item--hoverable', !isSecondItem);

    // Обновляем указатель
    if (pdvPointer) {
        pdvPointer.style.transform = isSecondItem ? 'translateX(100%)' : 'translateX(0%)';
    }

    // Управляем видимостью блока pfee
    if (pfeeBlock) {
        pfeeBlock.style.display = isSecondItem ? 'none' : 'block';
    }
}

function handleCdvClick(clickedItem) {
    const pdvItems = document.querySelectorAll('.cdv__item');
    const pdvPointer = document.querySelector('.cdv__pointer');
    const pfeeBlock = document.querySelector('.cfee');

    const index = Array.from(pdvItems).indexOf(clickedItem);
    const isSecondItem = index === 1;

    // Сохраняем состояние таба
    tabState = isSecondItem ? 'pickup' : 'delivery';

    // Меняем классы у элементов
    pdvItems[0].classList.toggle('cdv__item--active', !isSecondItem);
    pdvItems[0].classList.toggle('cdv__item--hoverable', isSecondItem);

    pdvItems[1].classList.toggle('cdv__item--active', isSecondItem);
    pdvItems[1].classList.toggle('cdv__item--hoverable', !isSecondItem);

    // Обновляем указатель
    if (pdvPointer) {
        pdvPointer.style.transform = isSecondItem ? 'translateX(100%)' : 'translateX(0%)';
    }

    // Управляем видимостью блока pfee
    if (pfeeBlock) {
        pfeeBlock.style.display = isSecondItem ? 'none' : 'block';
    }
}

function handleCoptClick(clickedCopt) {
    const cpreBlock = clickedCopt.closest('.cpre');
    if (!cpreBlock) return;
    const allCopts = cpreBlock.querySelectorAll('.copt');
    const preorderBlock = cpreBlock.querySelector('.cpre__preorder');
    allCopts.forEach(copt => {
        copt.classList.remove('copt--active');
    });
    clickedCopt.classList.add('copt--active');
    const isSecondCopt = clickedCopt.textContent.includes('Предзаказ');
    if (isSecondCopt) {
        if (!preorderBlock) {
            const preorderHTML = cpre;
            cpreBlock.insertAdjacentHTML('beforeend', preorderHTML);
        }
    } else {
        if (preorderBlock) {
            preorderBlock.remove();
        }
    }
}

function increaseDishQuantity(index) {
    const orders = getOrdersFromCookies();
    if (orders[index]) {
        orders[index].dish.quantity += 1;
        saveOrdersToCookies(orders);
        initCart();
    }
}

function decreaseDishQuantity(index) {
    const orders = getOrdersFromCookies();

    // Проверяем, существует ли блюдо с таким индексом
    if (orders[index]) {
        if (orders[index].dish.quantity > 1) {
            // Уменьшаем количество на 1
            orders[index].dish.quantity -= 1;
            saveOrdersToCookies(orders);
        } else {
            // Удаляем блюдо из заказа
            orders.splice(index, 1);
            saveOrdersToCookies(orders);
        }
        initCart();
    }
}

function saveOrdersToCookies(orders) {
    if (orders.length === 0) {
        // Если заказов нет, очищаем куки
        clearFoodOrders();
    } else {
        // Сохраняем заказы в куки
        const ordersJSON = JSON.stringify(orders);
        document.cookie = `foodOrders=${encodeURIComponent(ordersJSON)}; path=/; max-age=${60 * 60 * 24 * 7}`;
    }
}

initCart();








// Упрощенная форма отзывов без отправки на сервер
class SimpleReviewForm {
    constructor() {
        this.allTouched = false;
        this.verifyTimer = null;
        this.isInitialized = false;
        this.eventListeners = []; // Хранилище для обработчиков
        this.init();
    }

    init() {
        // Ждем полной загрузки DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                this.tryInitialize();
            });
        } else {
            this.tryInitialize();
        }
    }

    tryInitialize() {
        // Проверяем наличие формы каждые 100ms (на случай динамической загрузки)
        const checkInterval = setInterval(() => {
            if (document.querySelector('.vr__layout')) {
                clearInterval(checkInterval);
                this.initializeForm();
            }
        }, 100);

        // Останавливаем проверку через 5 секунд
        setTimeout(() => clearInterval(checkInterval), 5000);
    }

    initializeForm() {
        if (this.isInitialized) return;

        this.setupEventListeners();
        this.initMarkSliders();
        this.initUploaders();
        this.isInitialized = true;
    }

    // Инициализация слайдеров оценок
    initMarkSliders() {
        const sliders = document.querySelectorAll('.xform__mark-slider');
        console.log('Найдено слайдеров:', sliders.length);

        sliders.forEach(slider => {
            this.initSlider(slider);
        });

        // Первый слайдер активен
        const firstMark = document.querySelector('.xform__mark');
        if (firstMark) {
            firstMark.classList.add('xform__mark--glue');
        }
    }

    initSlider(pointer) {
        const container = pointer.parentNode;

        // Добавляем обработчик в хранилище
        const clickHandler = (e) => {
            if (e.target.classList.contains('xform__mark-slider') ||
                e.target.classList.contains('xform__mark-slider-text')) {
                return;
            }
            this.point2mark(e.clientX, container, pointer);
        };

        container.addEventListener('click', clickHandler);
        this.eventListeners.push({ element: container, type: 'click', handler: clickHandler });

        // Drag functionality
        let isDragging = false;

        const mouseDownHandler = (e) => {
            isDragging = true;
            document.documentElement.classList.add('xform--mark-grabbing');
            this.point2mark(e.clientX, container, pointer);
            e.preventDefault();
        };

        pointer.addEventListener('mousedown', mouseDownHandler);
        this.eventListeners.push({ element: pointer, type: 'mousedown', handler: mouseDownHandler });

        const mouseMoveHandler = (e) => {
            if (isDragging) {
                this.point2mark(e.clientX, container, pointer);
            }
        };

        document.addEventListener('mousemove', mouseMoveHandler);
        this.eventListeners.push({ element: document, type: 'mousemove', handler: mouseMoveHandler });

        const mouseUpHandler = () => {
            isDragging = false;
            document.documentElement.classList.remove('xform--mark-grabbing');
        };

        document.addEventListener('mouseup', mouseUpHandler);
        this.eventListeners.push({ element: document, type: 'mouseup', handler: mouseUpHandler });

        // Touch events for mobile
        const touchStartHandler = (e) => {
            isDragging = true;
            document.documentElement.classList.add('xform--mark-grabbing');
            this.point2mark(e.touches[0].clientX, container, pointer);
            e.preventDefault();
        };

        pointer.addEventListener('touchstart', touchStartHandler);
        this.eventListeners.push({ element: pointer, type: 'touchstart', handler: touchStartHandler });

        const touchMoveHandler = (e) => {
            if (isDragging) {
                this.point2mark(e.touches[0].clientX, container, pointer);
            }
        };

        document.addEventListener('touchmove', touchMoveHandler);
        this.eventListeners.push({ element: document, type: 'touchmove', handler: touchMoveHandler });

        const touchEndHandler = () => {
            isDragging = false;
            document.documentElement.classList.remove('xform--mark-grabbing');
        };

        document.addEventListener('touchend', touchEndHandler);
        this.eventListeners.push({ element: document, type: 'touchend', handler: touchEndHandler });
    }

    point2mark(x, container, pointer) {
        const bounds = container.getBoundingClientRect();
        const pointerBounds = pointer.getBoundingClientRect();
        const max = bounds.width - pointerBounds.width;
        let pos = x - bounds.left - pointerBounds.width / 2;

        // Ограничение позиции
        pos = Math.max(0, Math.min(pos, max));

        // Расчет оценки от 1 до 5
        const mark = Math.round((pos / max) * 4) + 1;
        const prevMark = parseInt(container.getAttribute('data-mark') || '0');

        container.setAttribute('data-mark', mark);
        pointer.style.transform = `translateX(${pos}px)`;
        container.classList.remove('xform__mark--glue');
        container.classList.add('xform__mark--touched');

        // Обновление текста оценки
        const textElement = pointer.querySelector('.xform__mark-slider-text');
        if (textElement) {
            // Берем текст для соответствующей оценки
            const markText = textElement.getAttribute(`data-mark${mark}`) || mark.toString();
            // Убеждаемся, что это одно число (берем первую цифру если нужно)
            const cleanMarkText = markText.replace(/[^0-9]/g, '').charAt(0) || mark.toString();
        }

        console.log('Оценка установлена:', mark);
    }

    // Инициализация загрузчиков изображений (эмуляция)
    initUploaders() {
        const imageContainers = document.querySelectorAll('.xform__image--empty');
        console.log('Найдено контейнеров для изображений:', imageContainers.length);

        imageContainers.forEach(container => {
            this.setupImageUpload(container);
        });
    }

    setupImageUpload(container) {
        const type = Array.from(container.classList)
            .find(cls => cls.startsWith('xform__image--'))
            ?.replace('xform__image--', '');

        if (!type) return;

        // Убедимся, что контейнер кликабельный
        container.style.cursor = 'pointer';
        container.style.position = 'relative';

        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'image/*';
        fileInput.style.display = 'none';
        fileInput.multiple = (type !== 'receipt' && type !== 'selfie');

        container.appendChild(fileInput);

        // Клик по контейнеру открывает выбор файла
        const clickHandler = (e) => {
            // Не открываем файловый диалог если кликнули на уже существующее изображение
            if (!e.target.classList.contains('xform__image-remove')) {
                fileInput.click();
            }
        };

        container.addEventListener('click', clickHandler);
        this.eventListeners.push({ element: container, type: 'click', handler: clickHandler });

        // Обработчик выбора файла
        const changeHandler = (e) => {
            this.handleFileSelect(e.target.files, container, type);
            // Сбрасываем значение input чтобы можно было выбрать тот же файл снова
            fileInput.value = '';
        };

        fileInput.addEventListener('change', changeHandler);
        this.eventListeners.push({ element: fileInput, type: 'change', handler: changeHandler });

        console.log('Загрузчик настроен для типа:', type);
    }

    handleFileSelect(files, container, type) {
        if (files.length === 0) return;

        console.log('Выбрано файлов:', files.length);

        Array.from(files).forEach(file => {
            if (!file.type.startsWith('image/')) {
                this.showAlert('Выберите изображение', 'warning');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                this.showAlert('Файл слишком большой (макс. 10MB)', 'warning');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                this.createImagePreview(e.target.result, container, type, file.name);
            };
            reader.readAsDataURL(file);
        });
    }

    createImagePreview(imageData, originalContainer, type, fileName) {
        // Создаем элемент для превью
        const preview = document.createElement('div');
        preview.className = 'xform__image xform__image--uploaded';
        preview.style.cssText = `
              width: 85px;
              height: 70px;
              background-image: url(${imageData});
              background-size: cover;
              background-position: center;
              background-repeat: no-repeat;
              border-radius: 8px;
              margin-right: 10px;
              display: inline-block;
              position: relative;
          `;

        preview.setAttribute('data-filename', fileName);

        // Кнопка удаления
        const removeBtn = document.createElement('span');
        removeBtn.className = 'xform__image-remove';
        removeBtn.textContent = '×';
        removeBtn.style.cssText = `
              position: absolute;
              top: -8px;
              right: -8px;
              background: red;
              color: white;
              width: 20px;
              height: 20px;
              border-radius: 50%;
              text-align: center;
              line-height: 20px;
              cursor: pointer;
              font-weight: bold;
              font-size: 14px;
              z-index: 10;
          `;

        const removeHandler = (e) => {
            e.stopPropagation();
            preview.remove();
        };

        removeBtn.addEventListener('click', removeHandler);
        this.eventListeners.push({ element: removeBtn, type: 'click', handler: removeHandler });

        preview.appendChild(removeBtn);

        // Вставляем в правильное место
        const imagesContainer = originalContainer.parentNode;
        imagesContainer.insertBefore(preview, originalContainer);

        // Для специальных типов (start, receipt, selfie) скрываем оригинальный контейнер
        if (type === 'start' || type === 'receipt' || type === 'selfie') {
            originalContainer.style.display = 'none';
        }

        console.log('Изображение загружено:', fileName);
    }

    // Настройка обработчиков событий
    setupEventListeners() {
        console.log('Настройка обработчиков событий...');

        // Закрытие модального окна
        const closeBtn = document.querySelector('.vr__close');
        if (closeBtn) {
            const closeHandler = (e) => {
                e.preventDefault();
                this.closeModal();
            };

            closeBtn.addEventListener('click', closeHandler);
            this.eventListeners.push({ element: closeBtn, type: 'click', handler: closeHandler });
            console.log('Кнопка закрытия настроена');
        }

        // Обработчик кнопки отправки
        const submitBtn = document.querySelector('.xform__save, .rwadd__save');
        if (submitBtn) {
            const submitHandler = (e) => {
                e.preventDefault();
                this.handleSubmit(e);
            };

            submitBtn.addEventListener('click', submitHandler);
            this.eventListeners.push({ element: submitBtn, type: 'click', handler: submitHandler });
            console.log('Кнопка отправки настроена');
        }

        // Обработчик SMS кнопок
        document.querySelectorAll('.rwadd__sms-send, .rwadd__sms-resend').forEach(btn => {
            const smsHandler = (e) => {
                e.preventDefault();
                this.handleSmsRequest(e);
            };

            btn.addEventListener('click', smsHandler);
            this.eventListeners.push({ element: btn, type: 'click', handler: smsHandler });
        });

        // Авторизация
        const authLink = document.querySelector('.rwadd__auth');
        if (authLink) {
            const authHandler = (e) => {
                e.preventDefault();
                this.showAlert('Функция авторизации', 'info');
            };

            authLink.addEventListener('click', authHandler);
            this.eventListeners.push({ element: authLink, type: 'click', handler: authHandler });
        }

        // Автоматическое изменение высоты textarea
        const textarea = document.querySelector('.rwadd__txt');
        if (textarea) {
            const inputHandler = () => {
                this.autoResizeTextarea(textarea);
            };

            textarea.addEventListener('input', inputHandler);
            this.eventListeners.push({ element: textarea, type: 'input', handler: inputHandler });
        }

        console.log('Все обработчики настроены');
    }

    autoResizeTextarea(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    handleSubmit(event) {
        console.log('Попытка отправки формы...');

        // Валидация формы
        if (!this.validateForm()) {
            return;
        }

        // Эмуляция отправки
        this.showAlert('Отзыв отправлен (эмуляция)', 'success');

        // Через 2 секунды закрываем окно
        setTimeout(() => {
            this.closeModal();
        }, 2000);
    }

    validateForm() {
        console.log('Валидация формы...');

        // Проверка обязательных полей
        const requiredFields = [
            { selector: '.rwadd__city', name: 'Город' },
            { selector: '.rwadd__company', name: 'Заведение' },
            { selector: '.rwadd__txt', name: 'Текст отзыва' }
        ];

        for (const field of requiredFields) {
            const element = document.querySelector(field.selector);
            if (element && !element.value.trim()) {
                this.showAlert(`Заполните поле "${field.name}"`, 'warning');
                element.focus();
                return false;
            }
        }

        // Проверка оценок
        const marks = document.querySelectorAll('.xform__mark[data-mark]');
        let hasEmptyMarks = false;

        marks.forEach(mark => {
            const value = parseInt(mark.getAttribute('data-mark'));
            if (isNaN(value) || value === 0) {
                hasEmptyMarks = true;
            }
        });

        if (hasEmptyMarks) {
            this.showAlert('Поставьте все оценки', 'warning');
            return false;
        }

        console.log('Форма валидна');
        return true;
    }

    handleSmsRequest(event) {
        console.log('Запрос SMS...');

        // Эмуляция отправки SMS
        this.showAlert('SMS отправлено (эмуляция)', 'success');
        this.startSmsTimer();
    }

    startSmsTimer() {
        let timeLeft = 30;
        const hintElement = document.querySelector('.rwadd__sms-hint');

        if (!hintElement) return;

        const updateTimer = () => {
            if (timeLeft <= 0) {
                clearInterval(this.verifyTimer);
                hintElement.innerHTML = 'Не получили SMS? <span class="rwadd__sms-resend">Выслать повторно</span>';

                // Обработчик для повторной отправки
                const resendLink = hintElement.querySelector('.rwadd__sms-resend');
                if (resendLink) {
                    const resendHandler = (e) => {
                        e.preventDefault();
                        this.handleSmsRequest(e);
                    };

                    resendLink.addEventListener('click', resendHandler);
                    this.eventListeners.push({ element: resendLink, type: 'click', handler: resendHandler });
                }
            } else {
                hintElement.innerHTML = `SMS придёт на телефон через <b>${timeLeft} сек.</b>`;
                timeLeft--;
            }
        };

        updateTimer();
        this.verifyTimer = setInterval(updateTimer, 1000);
    }

    showAlert(message, type = 'info') {
        console.log('Показ уведомления:', message);

        // Удаляем старые уведомления
        document.querySelectorAll('.custom-alert').forEach(alert => alert.remove());

        // Создаем уведомление
        const alert = document.createElement('div');
        alert.className = `custom-alert alert-${type}`;
        alert.innerHTML = message;
        alert.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              padding: 15px;
              margin: 10px;
              border-radius: 5px;
              background: ${type === 'success' ? '#d4edda' :
                type === 'warning' ? '#fff3cd' :
                    type === 'danger' ? '#f8d7da' : '#d1ecf1'};
              color: ${type === 'success' ? '#155724' :
                type === 'warning' ? '#856404' :
                    type === 'danger' ? '#721c24' : '#0c5460'};
              border: 1px solid ${type === 'success' ? '#c3e6cb' :
                type === 'warning' ? '#ffeaa7' :
                    type === 'danger' ? '#f5c6cb' : '#bee5eb'};
              z-index: 10000;
              min-width: 300px;
              font-family: Arial, sans-serif;
          `;

        document.body.appendChild(alert);

        // Автоматическое скрытие
        setTimeout(() => {
            if (alert.parentNode) {
                alert.remove();
            }
        }, 3000);
    }

    closeModal() {
        console.log('Закрытие модального окна...');

        // Удаляем все обработчики событий
        this.removeAllEventListeners();

        closeModal();

        if (this.verifyTimer) {
            clearInterval(this.verifyTimer);
            this.verifyTimer = null;
        }

        this.isInitialized = false;
        this.allTouched = false;
    }

    // Удаление всех обработчиков событий
    removeAllEventListeners() {
        this.eventListeners.forEach(({ element, type, handler }) => {
            if (element && element.removeEventListener) {
                try {
                    element.removeEventListener(type, handler);
                } catch (e) {
                    console.log('Ошибка при удалении обработчика:', e);
                }
            }
        });
        this.eventListeners = [];
    }
}

const reviewForm = new SimpleReviewForm();

// Глобальный доступ для ручного вызова
window.SimpleReviewForm = reviewForm;




// Функция для показа блока с сохраненными адресами
function showAddressSuggests(event) {
    // Останавливаем всплытие события, чтобы не сработал сразу же обработчик клика вне блока
    event.stopPropagation();

    // Находим элемент, на который кликнули
    const tickElement = event.currentTarget;

    // Находим родительский блок asearch
    const asearchBlock = tickElement.closest('.asearch');
    if (!asearchBlock) return;

    // Проверяем, не добавлен ли уже блок suggests
    const existingSuggests = asearchBlock.querySelector('.asearch__suggests');
    if (existingSuggests) {
        return; // Блок уже добавлен, ничего не делаем
    }

    // Создаем и добавляем блок с сохраненными адресами
    const suggestsHtml = `
          <div class="asearch__suggests">
              <div class="sv">
                  <div class="sv__list">
                      <div class="sv__empty">У вас пока нет сохранённых адресов. Желаете добавить?</div>
                  </div>
                  <div class="sv__add">Добавить новый адрес</div>
              </div>
          </div>
      `;

    asearchBlock.insertAdjacentHTML('beforeend', suggestsHtml);

    // Добавляем обработчик для кнопки добавления адреса
    const addButton = asearchBlock.querySelector('.sv__add');
    if (addButton) {
        addButton.addEventListener('click', function (e) {
            e.stopPropagation();
            alert('Функция добавления нового адреса');
            // Здесь можно добавить логику для добавления адреса
        });
    }

    // Добавляем обработчик клика по документу для скрытия блока
    setTimeout(() => {
        document.addEventListener('click', hideAddressSuggests);
    }, 0);
}

// Функция для скрытия блока с сохраненными адресами
function hideAddressSuggests(event) {
    // Проверяем, был ли клик внутри блока asearch__suggests или на кнопке ainput__tick
    const clickedElement = event.target;
    const isClickInsideSuggests = clickedElement.closest('.asearch__suggests');
    const isClickOnTick = clickedElement.closest('.ainput__tick');

    // Если клик был внутри блока suggests или на кнопке tick, не скрываем
    if (isClickInsideSuggests || isClickOnTick) {
        return;
    }

    // Находим все блоки suggests и удаляем их
    const allSuggests = document.querySelectorAll('.asearch__suggests');
    allSuggests.forEach(suggests => {
        suggests.remove();
    });

    // Удаляем обработчик клика по документу
    document.removeEventListener('click', hideAddressSuggests);
}

// Инициализация при загрузке страницы
// document.addEventListener('DOMContentLoaded', function() {
// Находим все кнопки ainput__tick внутри блоков asearch
const tickButtons = document.querySelectorAll('.asearch .ainput__tick');

// Добавляем обработчики клика на каждую кнопку
tickButtons.forEach(button => {
    button.addEventListener('click', showAddressSuggests);
});

// Также добавляем обработчик на динамически созданные элементы
const observer = new MutationObserver(function (mutations) {
    mutations.forEach(function (mutation) {
        if (mutation.addedNodes.length) {
            mutation.addedNodes.forEach(function (node) {
                if (node.nodeType === 1) { // Element node
                    const newTicks = node.querySelectorAll ? node.querySelectorAll('.asearch .ainput__tick') : [];
                    newTicks.forEach(button => {
                        if (!button.hasListener) {
                            button.addEventListener('click', showAddressSuggests);
                            button.hasListener = true;
                        }
                    });
                }
            });
        }
    });
});

// Начинаем наблюдение за изменениями в DOM
observer.observe(document.body, {
    childList: true,
    subtree: true
});
// });

// Альтернативный вариант для старых браузеров без MutationObserver
function checkForNewTickButtons() {
    const tickButtons = document.querySelectorAll('.asearch .ainput__tick:not([data-has-listener])');
    tickButtons.forEach(button => {
        button.addEventListener('click', showAddressSuggests);
        button.setAttribute('data-has-listener', 'true');
    });
}

// Периодическая проверка для старых браузеров
setInterval(checkForNewTickButtons, 1000);












function initMobileNavigation() {
    if (document.querySelector('.cnav--split')) {
        return;
    }

    let scrollTop, busy = false, prev = -1, titles, navItems, navScrollable, autoscrollTimer;
    let vr = null;

    // Функция для прокрутки к секции
    const scrollToSection = function (sectionId) {
        const el = document.querySelector('.nav__anchor[data-id="' + sectionId + '"]');
        if (el) {
            const pos = el.offsetTop - 95;
            window.scroll({
                top: pos,
                behavior: 'smooth'
            });
        }
    };

    // Функция для автоматической прокрутки навигационной панели
    const autoscrollBar = function (pos) {
        clearTimeout(autoscrollTimer);
        autoscrollTimer = setTimeout(function () {
            const curScroll = navScrollable.scrollLeft;
            if (pos < curScroll || Math.abs(curScroll - pos) > 150) {
                navScrollable.scroll({
                    left: pos,
                    behavior: 'smooth'
                });
            }
        }, 300);
    };

    // Функция обновления активного элемента навигации
    const update = function () {
        let current = 0;
        for (let i = 0; i < titles.length; i++) {
            const bounds = titles[i].getBoundingClientRect();
            if (bounds.top > 150) {
                break;
            } else {
                current = i;
            }
        }

        if (prev !== current) {
            if (navItems[prev]) {
                navItems[prev].classList.remove('cnav__item--active');
            }

            if (navItems[current]) {
                navItems[current].classList.add('cnav__item--active');
                prev = current;
                autoscrollBar(navItems[current].offsetLeft - 40);
            }
        }
        busy = false;
    };

    // Функция показа мобильного меню
    const showMobileMenu = function () {
        const html = [];
        Array.from(document.querySelectorAll('.cnav__item:not(.cnav__item--more)')).forEach(function (item) {
            html.push('<div class="cma__item" data-href="" data-section="' + item.dataset.section + '" data-count="' + (item.dataset.count || '') + '">' + item.innerHTML + '</div>');
        });

        // Создаем модальное окно для мобильного меню с правильной структурой
        const modalHTML = `
            <div class="vr__layout">
                <div class="vr__wrap">
                    <div class="vr">
                        <div class="vr__close"></div>
                        <div class="vr__header">Разделы меню</div>
                        <div class="vr__contents">
                            ${html.join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Создаем и добавляем модальное окно
        const modal = document.createElement('div');
        modal.innerHTML = modalHTML;
        document.body.appendChild(modal);
        const html1 = document.documentElement;
        html1.classList.add('vr--show-layout');
        html1.classList.add('vr--prevent-scroll');
        // Анимация появления
        setTimeout(() => {
            const vrLayout = modal.querySelector('.vr__layout');
            if (vrLayout) {
                vrLayout.style.opacity = '1';
                vrLayout.style.transform = 'translateY(0)';
            }
        }, 10);
        vr = modal;

        // Добавляем обработчики для элементов меню
        const menuItems = modal.querySelectorAll('.cma__item');
        menuItems.forEach(function (item) {
            item.addEventListener('click', function () {
                closeMobileMenu();
                scrollToSection(item.dataset.section);
            });
        });

        // Обработчик закрытия
        const closeBtn = modal.querySelector('.vr__close');
        if (closeBtn) {
            closeBtn.addEventListener('click', closeMobileMenu);
        }

        // Закрытие по клику вне области
        const vrLayout = modal.querySelector('.vr__layout');
        if (vrLayout) {
            vrLayout.addEventListener('click', function (e) {
                if (e.target === vrLayout) {
                    closeMobileMenu();
                }
            });
        }

        // Закрытие по клавише Escape
        document.addEventListener('keydown', function escapeHandler(e) {
            if (e.key === 'Escape') {
                closeMobileMenu();
                document.removeEventListener('keydown', escapeHandler);
            }
        });
    };

    // Функция закрытия мобильного меню
    const closeMobileMenu = function () {
        if (vr) {
            const vrLayout = vr.querySelector('.vr__layout');
            if (vrLayout) {
                const html1 = document.documentElement;
                html1.classList.remove('vr--show-layout');
                html1.classList.remove('vr--prevent-scroll');
                vrLayout.style.opacity = '0';
                vrLayout.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (vr.parentNode) {
                        vr.parentNode.removeChild(vr);
                    }
                    vr = null;
                }, 300);
            }
        }
    };

    // Инициализация элементов
    titles = document.querySelectorAll('.nav__anchor');
    navItems = document.querySelectorAll('.cnav__item');
    navScrollable = document.querySelector('.cnav__scrollable');

    // Если элементы найдены, инициализируем скролл
    if (titles.length && navItems.length && navScrollable) {
        window.addEventListener('scroll', function () {
            scrollTop = window.scrollY;
            if (!busy) {
                busy = true;
                requestAnimationFrame(update);
            }
        });

        // Добавляем обработчики кликов для элементов навигации
        Array.from(navItems).forEach(function (item) {
            if (!item.classList.contains('cnav__item--more')) {
                item.addEventListener('click', function () {
                    scrollToSection(item.dataset.section);
                });
            }
        });

        // Обработчик для кнопки "Ещё" в мобильной версии
        const moreButton = document.querySelector('.cnav__item--more');
        if (moreButton) {
            moreButton.addEventListener('click', showMobileMenu);
        }

        // Инициализация при загрузке
        setTimeout(update, 100);
    }
}

// Запускаем инициализацию мобильной навигации
initMobileNavigation();

// Также можно запустить при изменении размера окна для переинициализации
window.addEventListener('resize', function () {
    setTimeout(initMobileNavigation, 100);
});
// });

document.addEventListener('click', function (e) {
    const payType = e.target.closest('.cpay__types .cpay__type');
    if (payType) {
        handleCpayTypeClick(payType);
    }
});

function handleCpayTypeClick(clickedType) {
    const cpayBlock = clickedType.closest('.cpay');
    if (!cpayBlock) return;
    const allTypes = cpayBlock.querySelectorAll('.cpay__type');
    const merchantBlock = cpayBlock.querySelector('.cpay__merchant');

    allTypes.forEach(type => type.classList.remove('copt--active'));
    clickedType.classList.add('copt--active');

    const isCard = clickedType.textContent.includes('Карт');

    if (isCard) {
        if (!merchantBlock) {
            const merchantHTML = `
          <!--<div class="ctinput__wrap cpay__merchant">
            <div class="ctinput__caption">Выберите карту для оплаты</div>
             <div class="ctinput ctinput--tick cpay__merchant-input">Сохранить новую карту</div> 
          </div> -->`;
            cpayBlock.insertAdjacentHTML('beforeend', merchantHTML);
        }
    } else {
        if (merchantBlock) merchantBlock.remove();
    }
}
!function(){function e(e,t,n){var a="";if(n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3),a="; expires="+o.toUTCString()}document.cookie=e+"="+encodeURIComponent(t)+a+"; path=/"}function t(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([.$?*|{}()\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):""}function n(n,a){if(!n||n.dataset._cookieBound)return;var o=function(){var t=n.value?String(n.value).trim():"";t&&(i[a]=t,e(a,t,30))};var c=t(a);c&&(n.value=c),n.addEventListener("input",o),n.addEventListener("change",o),n.addEventListener("blur",o),n.dataset._cookieBound="1"}function a(){var e=document;var t=e.querySelector('input[name="adr"]'),a=e.querySelector('.cclient'),o=a?a.querySelector('.ctinput:not([type])'):e.querySelector('.cclient .ctinput'),c=e.querySelector('input[type="tel"]');n(t,"adr"),n(o,"name"),n(c,"phone");var d=e.querySelector('.csform__content form')||e.querySelector('form');d&&d.addEventListener('submit',function(){i.adr&&r('adr',i.adr,30),i.name&&r('name',i.name,30),i.phone&&r('phone',i.phone,30)},{capture:!0})}function o(e){e&&('INPUT'===e.nodeName&&s(e),e.querySelectorAll&&e.querySelectorAll('input').forEach(s))}function s(e){if(e.matches('input[name="adr"]'))return n(e,'adr');if(e.matches('.cclient .ctinput')&&!e.hasAttribute('type'))return n(e,'name');if(e.matches('input[type="tel"]'))return n(e,'phone')}var i={};function r(t,n,a){e(t,n,a)}function c(){a();var e=new MutationObserver(function(e){e.forEach(function(e){e.addedNodes&&e.addedNodes.forEach(o)})});document.body&&e.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener('focusin',function(e){s(e.target)},!0)}"loading"!==document.readyState?c():document.addEventListener("DOMContentLoaded",c)}();

// Функциональность поиска блюд для мобильной версии
document.addEventListener('DOMContentLoaded', function() {
    // Собираем все блюда из меню
    const menuItems = [];
    const dishes = document.querySelectorAll('.ddish');
    
    dishes.forEach(dish => {
        const nameElement = dish.querySelector('.ddish__name a');
        const photoElement = dish.querySelector('.ddish__photo');
        const priceElement = dish.querySelector('.ddish__sum--final');
        const sectionElement = dish.closest('.sect');
        const sectionTitle = sectionElement ? sectionElement.querySelector('.sect__title').textContent : '';
        const anchorElement = dish.querySelector('.ddish__anchor');
        const dishId = dish.dataset.id;
        
        if (nameElement) {
            menuItems.push({
                name: nameElement.textContent.trim(),
                url: nameElement.href,
                photo: photoElement ? photoElement.src : '',
                price: priceElement ? priceElement.textContent.trim() : '',
                section: sectionTitle,
                element: dish,
                anchorId: anchorElement ? anchorElement.id : `dish${dishId}`,
                dishId: dishId
            });
        }
    });
    
    // Функция поиска
    function searchDishes(query) {
        if (!query || query.length < 2) {
            hideSearchResults();
            return;
        }
        
        const results = menuItems.filter(item => 
            item.name.toLowerCase().includes(query.toLowerCase()) ||
            item.section.toLowerCase().includes(query.toLowerCase())
        ).slice(0, 6); // Ограничиваем до 6 результатов для мобильной версии
        
        showSearchResults(results);
    }
    
    // Показать результаты поиска
    function showSearchResults(results) {
        const searchResults = document.querySelector('.search__results');
        if (!searchResults) return;
        
        if (results.length === 0) {
            searchResults.innerHTML = '<div class="search__no-results">Ничего не найдено</div>';
        } else {
            searchResults.innerHTML = results.map((item, index) => `
                <a href="#" class="tdrop__option search__item search__item--with-photo" data-item="${index}">
                    <img src="${item.photo}" class="search__photo" alt="${item.name}">
                    <div class="search__title">${item.name}</div>
                    <div class="search__sub">${item.section} • ${item.price}</div>
                </a>
            `).join('');
            
            // Добавляем обработчики клика на результаты
            searchResults.querySelectorAll('.tdrop__option').forEach((option, index) => {
                option.addEventListener('click', function(e) {
                    e.preventDefault();
                    const item = results[index];
                    hideSearchResults(); // Скрываем результаты поиска
                    
                    // Закрываем модальное окно поиска
                    closeModal();
                    
                    // Скроллим к блюду
                    if (item.anchorId) {
                        const targetElement = document.getElementById(item.anchorId);
                        if (targetElement) {
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                            
                            // Добавляем временную подсветку блюда
                            const dishElement = item.element;
                            if (dishElement) {
                                dishElement.style.transition = 'box-shadow 0.3s ease';
                                dishElement.style.boxShadow = '0 0 20px rgba(0, 174, 239, 0.5)';
                                
                                setTimeout(() => {
                                    dishElement.style.boxShadow = '';
                                }, 2000);
                            }
                        }
                    }
                });
            });
        }
    }
    
    // Скрыть результаты поиска
    function hideSearchResults() {
        const searchResults = document.querySelector('.search__results');
        if (searchResults) {
            searchResults.innerHTML = '';
        }
    }
    
    // Обработчик ввода в поле поиска (для мобильной версии)
    let searchTimeout;
    document.addEventListener('input', function(e) {
        if (e.target.classList.contains('search__input')) {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            
            if (query.length >= 2) {
                searchTimeout = setTimeout(() => {
                    searchDishes(query);
                }, 300);
            } else {
                hideSearchResults();
            }
        }
    });
    
    // Обработчик кнопки отмены поиска
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('search__cancel')) {
            const searchInput = e.target.parentElement.querySelector('.search__input');
            if (searchInput) {
                searchInput.value = '';
                hideSearchResults();
                searchInput.focus();
            }
        }
    });
});